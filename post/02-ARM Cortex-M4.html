<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>02-ARM Cortex-M4 | Chilh</title><meta name="author" content="chilh"><meta name="copyright" content="chilh"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="微处理器笔记 02-ARM Cortex-M4">
<meta property="og:type" content="article">
<meta property="og:title" content="02-ARM Cortex-M4">
<meta property="og:url" content="https://chilh.top/post/02-ARM%20Cortex-M4.html">
<meta property="og:site_name" content="Chilh">
<meta property="og:description" content="微处理器笔记 02-ARM Cortex-M4">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202306161931372.webp">
<meta property="article:published_time" content="2023-06-16T10:00:35.000Z">
<meta property="article:modified_time" content="2023-07-21T06:13:44.605Z">
<meta property="article:author" content="chilh">
<meta property="article:tag" content="大三下课程笔记">
<meta property="article:tag" content="BUPT">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202306161931372.webp"><link rel="shortcut icon" href="/"><link rel="canonical" href="https://chilh.top/post/02-ARM%20Cortex-M4.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"prismjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: true,
    post: true
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":50,"languages":{"author":"作者: chilh","link":"链接: ","source":"来源: Chilh","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#1f1f1f","position":"bottom-left"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  }
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '02-ARM Cortex-M4',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-07-21 14:13:44'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><script charset="UTF-8" id="LA_COLLECT" src="//sdk.51.la/js-sdk-pro.min.js"></script><script>LA.init({id:"Jz34H84gllFAWP2o",ck:"Jz34H84gllFAWP2o"})</script><script src="https://sdk.51.la/perf/js-sdk-perf.min.js" crossorigin="anonymous"></script><script> new LingQue.Monitor().init({id:"Jz365mPYN13QqIwT"});</script><script src="https://npm.elemecdn.com/echarts@4.9.0/dist/echarts.min.js"></script><script src="https://npm.elemecdn.com/echarts@4.9.0/map/js/china.js"></script><script src="https://npm.elemecdn.com/echarts@4.9.0/dist/echarts.min.js"></script><meta name="generator" content="Hexo 6.1.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
</head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><script>const preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',()=> { preloader.endLoading() })

if (false) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/%E5%A4%B4%E5%83%8F.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">66</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">17</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">5</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/gallery/"><i class="fa-fw fas fa-camera-retro"></i><span> 图库</span></a></div><div class="menus_item"><a class="site-page" href="/charts/"><i class="fa-fw fa fa-heartbeat"></i><span> 统计</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202306161931372.webp')"><nav id="nav"><span id="blog-info"><a href="/" title="Chilh"><span class="site-name">Chilh</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/gallery/"><i class="fa-fw fas fa-camera-retro"></i><span> 图库</span></a></div><div class="menus_item"><a class="site-page" href="/charts/"><i class="fa-fw fa fa-heartbeat"></i><span> 统计</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">02-ARM Cortex-M4</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-06-16T10:00:35.000Z" title="发表于 2023-06-16 18:00:35">2023-06-16</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-07-21T06:13:44.605Z" title="更新于 2023-07-21 14:13:44">2023-07-21</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%A4%A7%E5%AD%A6%E7%AC%94%E8%AE%B0/">大学笔记</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">3.6k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>15分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="02-ARM Cortex-M4"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="ARM-Cortex-M4"><a href="#ARM-Cortex-M4" class="headerlink" title="ARM Cortex-M4"></a>ARM Cortex-M4</h1><h2 id="What-is-ARM-Architecture"><a href="#What-is-ARM-Architecture" class="headerlink" title="What is ARM Architecture?"></a>What is ARM Architecture?</h2><p>ARM architecture is a family of RISC（精简指令集）-based processor architectures</p>
<p>CISC计算机使用</p>
<p>先进的RISC机器</p>
<p>以其电源效率而闻名;</p>
<p>因此被广泛应用于移动设备，如智能手机和平板电脑</p>
<p>由ARM设计并授权给广泛的生态系统</p>
<ul>
<li>ARM Holdings</li>
</ul>
<p>•该公司设计基于arm的处理器;</p>
<p>•不制造，但将设计授权给半导体合作伙伴，后者将自己的知识产权(IP)添加到ARM的IP之上，制造并销售给客户;</p>
<p>•提供除处理器之外的其他IP，如物理IP、互连IP、图形核心和开发工具。</p>
<p>在一家公司获得了Cortex-M处理器设计的授权后，ARM则会以Verilog-HDL(硬件描述语言)语言的形式提供设计的源代码。这些公司中的设计工程师随后会将外设和存储器等他们自己的设计模块添加进来，并且使用各种EDA工具将整个设计从Verilog-HDL和其他多种形式转换为晶体管层级的芯片设计。</p>
<h3 id="Processor-Families"><a href="#Processor-Families" class="headerlink" title="Processor Families"></a>Processor Families</h3><p><img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202303091339400.png" alt="image-20230309133953252"></p>
<p><img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202303272336349.png" alt="image-20230327233615301"></p>
<h3 id="Design-an-ARM-based-SoC（片上系统）"><a href="#Design-an-ARM-based-SoC（片上系统）" class="headerlink" title="Design an ARM-based SoC（片上系统）"></a>Design an ARM-based SoC（片上系统）</h3><p><img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202303081334904.png" alt="image-20230308133405720"></p>
<h3 id="ARM-Cortex-M-Series"><a href="#ARM-Cortex-M-Series" class="headerlink" title="ARM Cortex-M Series"></a>ARM Cortex-M Series</h3><p>Cortex-M series: Cortex-M0, M0+, M1, M3, M4.</p>
<p><img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202303081359255.png" alt="image-20230308135911175"></p>
<ul>
<li>Energy-efficiency</li>
</ul>
<p>​		• Lower energy cost, longer battery life</p>
<p>​	与其他32位微控制器设计相比，Cortex-M处理器相对较小。Cortex-M处理器也进行了低功耗的优化</p>
<ul>
<li><p>Smaller code</p>
<p>更低的硅成本</p>
</li>
<li><p>Ease of use（易于使用）</p>
<p>Faster software development and reuse</p>
<p>Cortex-M处理器具有简单、线性的存储器映射</p>
</li>
<li><p>Embedded applications</p>
<p>智能计量，人机界面设备，汽车和工业控制系统，白色家电，消费品和医疗仪器</p>
</li>
</ul>
<h3 id="ARM-Processors-vs-ARM-Architectures"><a href="#ARM-Processors-vs-ARM-Architectures" class="headerlink" title="ARM Processors vs. ARM Architectures"></a>ARM Processors vs. ARM Architectures</h3><ul>
<li><p>ARM architecture </p>
<p>• Describes the details of instruction set, programmer’s model, exception model, and memory map 描述指令集、程序员模型、异常模型和内存映射的细节 是公司的设计 </p>
</li>
<li><p>ARM processor</p>
<p>• Developed using one of the ARM architectures</p>
<p>• More implementation details, such as timing information</p>
</li>
</ul>
<h4 id="ARM-Cortex-M4-Processor-Overview"><a href="#ARM-Cortex-M4-Processor-Overview" class="headerlink" title="ARM Cortex-M4 Processor Overview"></a><strong>ARM Cortex-M4 Processor Overview</strong></h4><h5 id="High-Performance-Efficiency"><a href="#High-Performance-Efficiency" class="headerlink" title="High Performance Efficiency"></a>High Performance Efficiency</h5><p>• 1.25 DMIPS/MHz (Dhrystone Million Instructions Per Second / MHz) at the order of µWatts / MHz（Dhrystone是测量处理器运算能力的最常见<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E5%9F%BA%E5%87%86%E7%A8%8B%E5%BA%8F/1200074">基准程序</a>）</p>
<ul>
<li><p>word size:32-bit Reduced Instruction Set Computing (RISC) processor</p>
<p><strong>每次取指令都是32位的，而多数指令则是16位的，因此一次可以取两条指令，存储器接口上的多余带宽也带来了更高的性能和更佳的能耗效率。</strong></p>
</li>
<li><p><strong>Harvard architecture</strong>(data 和 instruction分离，可以同时fetch)</p>
</li>
<li><p>Low Power Consumption（低功耗）</p>
</li>
<li><p>3-stage（fetch+Decode+excute） + branch speculation pipeline</p>
<p>三级流水线结构使得包括乘法在内的多数指令，可以在单周期内执行，</p>
</li>
<li><p>Supported Interrupts</p>
<p>• <strong>Non-maskable Interrupt</strong> (NMI) + 1 to 240 physical interrupts</p>
<p>• 8 to 256 interrupt priority level（中断和多个系统异常具有可编程的优先级）</p>
<p>支持最多240个中断输入、不可屏蔽中断(NMI)输入和多个系统异常。每个中断(NMI除外)都可以被单独使能或禁止。</p>
</li>
<li><p>Supports Sleep Modes</p>
<p>Up to 240 Wake-up Interrupts</p>
</li>
<li><p>Enhanced Instructions</p>
<p>• Hardware Divide (2-12 Cycles)</p>
<p>• Single-Cycle 16/32-bit MAC, Single-cycle dual 16-bit MAC</p>
</li>
<li><p>Memory Protection Unit (MPU)</p>
<p>Optional 8 region MPU with sub regions and background region</p>
</li>
</ul>
<h4 id="Cortex-M4-Block-Diagram"><a href="#Cortex-M4-Block-Diagram" class="headerlink" title="Cortex-M4 Block Diagram"></a><strong>Cortex-M4 Block Diagram</strong></h4><p>Processor pipeline stages</p>
<p>• <strong>Three-stage pipeline: fetch, decode, and execution</strong></p>
<p>• Some instructions may take multiple cycles to execute, in which case the pipeline will be stalled</p>
<p>• The pipeline will be flushed if a branch instruction is executed</p>
<p>• Up to two instructions can be fetched in one transfer (<strong>16-bit instructions</strong>)</p>
<p>word set是32bit所以一个时间可以fetch两条instruction，但是每次只能执行一次decode</p>
<p><img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202303090858053.png" alt="image-20230309085807011"></p>
<p>尽可能的填满cpu:提升使用效率</p>
<ul>
<li><p>Bus interconnect</p>
<p>Allows data transfer to take place on different buses simultaneously</p>
<p>Provides data transfer management,同时读内存和指令</p>
</li>
</ul>
<h2 id="数据与指令"><a href="#数据与指令" class="headerlink" title="数据与指令"></a>数据与指令</h2><p>寄存器里既可以存数据也可存指令</p>
<p><img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202303272327399.png" alt="image-20230327232708345"></p>
<h2 id="Registers"><a href="#Registers" class="headerlink" title="Registers"></a><strong>Registers</strong></h2><p>The internal registers are used to store and process <strong>temporary data</strong> within the processor core.</p>
<p><strong>All registers are inside the processor core, hence they can be accessed quickly.</strong></p>
<h3 id="Load-store-architecture"><a href="#Load-store-architecture" class="headerlink" title="Load-store architecture"></a><strong>Load-store architecture</strong></h3><p>对于ARM架构，若处理的是存储器中的数据，就需要将其从存储器加载到寄存器组中的寄存器里。在处理器内处理完后，若有必要，还要写回存储器，这种方式一般被称作“加载一存储架构”</p>
<img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202303272330781.png" alt="image-20230327233058730" style="zoom:67%;">

<h3 id="Register-bank（寄存器组）"><a href="#Register-bank（寄存器组）" class="headerlink" title="Register bank（寄存器组）"></a><strong>Register bank</strong>（寄存器组）</h3><p>寄存器组中有16个寄存器，其中13个为32位通用目的寄存器，其他3个则有特殊用途</p>
<p><img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202303091515432.png" alt="image-20230309151559360"></p>
<h4 id="R0～R12"><a href="#R0～R12" class="headerlink" title="R0～R12"></a>R0～R12</h4><p><strong>general purpose registers</strong></p>
<p>Low registers (R0 – R7) can be accessed by any instruction</p>
<p>High registers (R8 – R12) sometimes cannot be accessed（<strong>用于32位指令和几个16位指令</strong>）</p>
<h4 id="R13-Stack-Pointer-SP"><a href="#R13-Stack-Pointer-SP" class="headerlink" title="R13: Stack Pointer (SP)"></a>R13: Stack Pointer (SP)</h4><p>栈指针</p>
<p>• Records the current address of the stack</p>
<p>两个栈指针：</p>
<p>主栈指针(<strong>MSP</strong>)为默认的栈指针，<strong>在复位后</strong>或处理器处于处理模式时，其会被处理器选择使用。另外一个栈指针名为进程栈指针(PSP),其只能用于线程模式</p>
<h4 id="R14-Link-Register-LR"><a href="#R14-Link-Register-LR" class="headerlink" title="R14: Link Register (LR)"></a>R14: Link Register (LR)</h4><p><strong>链接寄存器(LR)</strong></p>
<p>store the return address of a subroutine or a function call函数或子程序调用时返回地址的保存</p>
<p>The program counter (PC) will load the value from LR after a function is finished</p>
<p><img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202303091526029.png" alt="image-20230309152622869"></p>
<p>调用子程序时，先将pc存到LR中，如何让pc指向要调用的程序，最后将LR中地址覆盖回去当执行了函数或子程序调用后，LR的数值会自动更新</p>
<h4 id="R15-Program-Counter-PC"><a href="#R15-Program-Counter-PC" class="headerlink" title="R15: Program Counter (PC)"></a>R15: Program Counter (PC)</h4><p>R15为程序计数器(PC)</p>
<p> <strong>Records the address of the next instruction for execution</strong></p>
<p>每次操作自动加4(对于32位指令代码)，分支操作除外</p>
<h4 id="xPSR-combined-Program-Status-Register"><a href="#xPSR-combined-Program-Status-Register" class="headerlink" title="xPSR, combined Program Status Register"></a>xPSR, combined Program Status Register</h4><p>组合程序状态寄存器</p>
<p>组合程序状态寄存器包括以下三个状态寄存器Provides information about program execution and ALU flags：</p>
<p>应用 Application PSR(APSR)</p>
<p>执行 Interrupt PSR(EPSR)</p>
<p>中断 Execution PSR(IPSR)</p>
<p><img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202303091604906.png" alt="image-20230309160446867"></p>
<p>这三个寄存器可以通过一个组合寄存器访问</p>
<h5 id="APSR"><a href="#APSR" class="headerlink" title="APSR"></a>APSR</h5><p>N: negative flag – set to one if the result from ALU is negative</p>
<p>Z: zero flag – set to one if the result from ALU is zero</p>
<p> C: carry flag – set to one if an unsigned overflow occurs</p>
<p>C：进位/借位标志。表示在加法/减法运算中，产生了进位/借位。</p>
<p>V: <strong>overflow flag</strong> – set to one if a signed overflow occurs</p>
<p>Q: DSP overflow and saturation flag – set to one if saturation has occurred in saturating arithmetic instructions, or overflow has occurred in certain multiply instructions</p>
<h5 id="IPSR"><a href="#IPSR" class="headerlink" title="IPSR"></a>IPSR</h5><p>• ISR number – current executing interrupt service routine number</p>
<p>包含了当前正在执行的中断服务程序编号</p>
<h5 id="EPSR"><a href="#EPSR" class="headerlink" title="EPSR"></a>EPSR</h5><p>• T: Thumb state – <strong>always one</strong> since Cortex-M4 only supports the Thumb state (more on processor states in the next module)</p>
<p>• IC/IT: Interrupt-Continuable Instruction (ICI) bit, IF-THEN instruction status bit</p>
<h4 id="Interrupt-mask-registers"><a href="#Interrupt-mask-registers" class="headerlink" title="Interrupt mask registers"></a>Interrupt mask registers</h4><p>• 1-bit PRIMASK </p>
<p>Set to one will block all the interrupts apart from non-maskable interrupt (NMI) and the hard fault exception</p>
<p>• 1-bit FAULTMASK </p>
<p>Set to one will block all the interrupts apart from NMI</p>
<p>• 1-bit BASEPRI </p>
<p>Set to a non zero value will block all interrupts of the same or lower level (only allow for interrupts with higher priorities)</p>
<h4 id="CONTROL-special-register"><a href="#CONTROL-special-register" class="headerlink" title="CONTROL: special register"></a>CONTROL: special register</h4><p>1-bit stack definition</p>
<p><strong>Set to one: use the process stack pointer (PSP)</strong></p>
<p><strong>Clear to zero: use the main stack pointer (MSP)</strong></p>
<h2 id="Cortex-M4-Memory-Map"><a href="#Cortex-M4-Memory-Map" class="headerlink" title="Cortex-M4 Memory Map"></a><strong>Cortex-M4 Memory Map</strong></h2><p>存储器映射</p>
<p>Cortex-M4 processor has a 4GB memory space（32Byte=$2^2*2^{30}$）, which is architecturally defined as a number of regions</p>
<p><strong>1word=4byte（32bits）内存地址以字节为单位</strong></p>
<p>arm中可以编址的最小单元是字存储单元，则该计算机称为按字寻址的计算机（4byte）每一个寄存器都是占用4个字节即32位</p>
<p>4GB的存储器空间被划分为多个区域，用于预定义的存储器和外设，以优化处理器设计的性能</p>
<p>• Each region is given for recommended usage</p>
<p>• Easy for software programmer to port between different devices</p>
<p>尽管存在默认内存映射，但用户可以灵活地定义内存映射的实际使用情况</p>
<p><img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202303100829376.png" alt="image-20230310082909300"></p>
<p><img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202303100836935.png" alt="image-20230310083611870"></p>
<h5 id="Code-Region"><a href="#Code-Region" class="headerlink" title="Code Region"></a>Code Region</h5><p>​	• Primarily used to <strong>store program code</strong> Can also be used as memory for <strong>constant data</strong> On-chip memory, such as on-chip FLASH </p>
<p><strong>保存代码和常数</strong></p>
<h5 id="SRAM-Region"><a href="#SRAM-Region" class="headerlink" title="SRAM Region"></a>SRAM Region</h5><p>store data, such as heaps and stacks</p>
<p>Can also be used for program code</p>
<p><strong>可读写数据和堆栈</strong></p>
<p>尽管它的名字是“SRAM”，但实际的设备可能是SRAM、SDRAM或其他类型</p>
<h5 id="Peripheral-Region外设"><a href="#Peripheral-Region外设" class="headerlink" title="Peripheral Region外设"></a>Peripheral Region外设</h5><p>主要通过高级高性能总线(AHB)或高级外设总线(APB)外设用于片上外设</p>
<h5 id="External-RAM-Region"><a href="#External-RAM-Region" class="headerlink" title="External RAM Region"></a>External RAM Region</h5><p>可以用来存储大数据块，或者是芯片外存储器中的内存缓存</p>
<p> slower than on-chip SRAM region</p>
<h5 id="External-Device-Region"><a href="#External-Device-Region" class="headerlink" title="External Device Region"></a>External Device Region</h5><p> is used to map to off-chip external devices such as SD card‘</p>
<h5 id="Internal-Private-Peripheral-Bus-PPB"><a href="#Internal-Private-Peripheral-Bus-PPB" class="headerlink" title="Internal Private Peripheral Bus (PPB)"></a>Internal Private Peripheral Bus (PPB)</h5><p>Used inside the processor core for internal control</p>
<p> Within PPB, a special range of memory is defined as System Control Space (SCS)</p>
<p>嵌套矢量中断控制器(NVIC)是SCS的一部分</p>
<p><img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202303100836557.png" alt="image-20230310083639498"></p>
<h3 id="Bit-band-Operations"><a href="#Bit-band-Operations" class="headerlink" title="Bit-band Operations"></a><strong>Bit-band Operations</strong></h3><p>位段操作</p>
<p>利用位段操作，一次加载/存储操作可以访问(读/写)一个位</p>
<p>To change a single bit of one 32-bit data </p>
<ul>
<li><p>Normal operation (read-modify-write procedure)</p>
<p>•读取32位数据的值</p>
<p>•修改单个位，同时保持其他位不变(掩码)</p>
<p>•将32位值写回相同的地址</p>
</li>
<li><p>Bit-band operation</p>
<p>直接将单个位(0或1)写入数据的“bit-band alias address”</p>
</li>
<li><p><strong>Bit-band alias address</strong></p>
<p>• Each bit-band alias address is mapped to a real data address</p>
<p>• When writing to the bit-band alias address, only a single bit of the data will be changed</p>
</li>
</ul>
<p>• For example, in order to set bit[3] in word data in address 0x20000000:</p>
<pre class="line-numbers language-assembly" data-language="assembly"><code class="language-assembly">;Read-Modify-Write Operation
LDR R1, =0x20000000 ;Setup address
LDR R0, [R1] ;Read
ORR.W R0, #0x8 ;Modify bit（or：或上一个0...01000(0x8)改变位）
//ORR 或
STR R0, [R1] ;Write back<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-assembly" data-language="assembly"><code class="language-assembly">;Bit-band Operation
LDR R1, =0x2200000C ;Setup alias（把要改的bit的地址存好）
MOV R0, #1 ;Load data（改后的结果）
STR R0, [R1] ;Write back（覆盖掉）把R0存到R1存的地址na'l<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>Each bit of the 32-bit data is one-to-one mapped to the bit band alias address</strong></p>
<p>当使用位段别名地址时，每个位都可以通过对应的字对齐地址的最低位(LSB)单独访问</p>
<p><img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202303100900757.png" alt="image-20230310090020703"></p>
<p><img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202303100923909.png" alt="在这里插入图片描述"></p>
<p>相邻32-bite data在地址上相差4byte，每个字段中的每个bit是没有对应地址的（一个字段只能占用四个地址(每个字节占用一个)如上图最后一行）所以想访问每个bit需要位带别名（每个bit被一个长为4byte地址表示(1bit数据地址用32bit表示)，arm<strong>规定相邻bits的位带别名相差4bits</strong>）</p>
<p>所以在SRAM region和Peripherals region</p>
<p><strong>都有1MB的数据对应32MB的Bit-band alias，另外有31MB的数据没有Bit-band alias?</strong></p>
<p><img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202303100935960.png" alt="image-20230310093520915"></p>
<p><img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202303100937244.png" alt="image-20230310093730197"></p>
<h4 id="Benefits-of-Bit-Band-Operations"><a href="#Benefits-of-Bit-Band-Operations" class="headerlink" title="Benefits of Bit-Band Operations"></a><strong>Benefits of Bit-Band Operations</strong></h4><p>• Faster bit operations</p>
<p>• Fewer instructions</p>
<p>• <strong>Atomic operation, avoid hazards</strong></p>
<p>如果在Read-Modify-Write操作期间触发并服务中断，并且中断服务例程修改相同的数据，则会发生数据冲突</p>
<p><img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202303101145551.png" alt="image-20230310114556433"></p>
<h3 id="Cortex-M4-Program-Image"><a href="#Cortex-M4-Program-Image" class="headerlink" title="Cortex-M4 Program Image"></a><strong>Cortex-M4 Program Image</strong></h3><p>code部分： </p>
<p>• Vector table – includes the starting addresses of <strong>exceptions</strong> (vectors) and the value of the main stack point (MSP);</p>
<p>• C start-up routine;</p>
<p>• Program code – application code and data;</p>
<p>• C library code – program codes for C library functions.</p>
<p><img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202303101421055.png" alt="image-20230310142102986"></p>
<h4 id="Reset-Behaviour"><a href="#Reset-Behaviour" class="headerlink" title="Reset Behaviour"></a><strong>Reset Behaviour</strong></h4><p><img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202303101428179.png" alt="image-20230310142815128"></p>
<p>After reset, the processor:</p>
<ul>
<li><p>reads the initial MSP（主栈指针，此时为0x00000000） value to set up the stack</p>
</li>
<li><p>Then reads the reset vector（跳转到其它程序）</p>
</li>
<li><p>分支到程序执行地址的开始(复位处理程序);</p>
</li>
<li><p>Subsequently executes program instructions</p>
</li>
</ul>
<h4 id="Cortex-M4-Endianness字节顺序"><a href="#Cortex-M4-Endianness字节顺序" class="headerlink" title="Cortex-M4 Endianness字节顺序"></a><strong>Cortex-M4 Endianness</strong>字节顺序</h4><p>Endian refers to the order of bytes stored in memory</p>
<p>• Little endian: lowest byte of a word-size data is stored in bit 0 to bit 7 低对低，高对高</p>
<p>1个字节是8个比特是两个十六进制数</p>
<p><img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202303272316105.png" alt="image-20230327231629040"></p>
<p>这个两字节的数存放在0x1002（低位字节的地址）</p>
<p><img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202303272317646.png" alt="image-20230327231722577"></p>
<p>这个四字节的数存放在0x100（最低字节的地址为这个数的地址）</p>
<img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202303272322929.png" alt="image-20230327232200861" style="zoom:50%;">



<p>• Big endian: lowest byte of a word-size data is stored in bit 24 to bit 31</p>
<p><img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202303101524911.png" alt="image-20230310152458858"></p>
<p><strong>Cortex-M4 supports both little endian (default) and big endian.</strong></p>
<h2 id="ARM-Cortex-M4-Processor-Instruction-Set"><a href="#ARM-Cortex-M4-Processor-Instruction-Set" class="headerlink" title="ARM Cortex-M4 Processor Instruction Set"></a><strong>ARM Cortex-M4 Processor Instruction Set</strong></h2><h3 id="Mix-of-ARM-and-Thumb-1-Instruction-sets"><a href="#Mix-of-ARM-and-Thumb-1-Instruction-sets" class="headerlink" title="Mix of ARM and Thumb-1 Instruction sets"></a>Mix of ARM and Thumb-1 Instruction sets</h3><p>Benefit from both 32-bit ARM (<strong>high performance</strong>) and 16-bit Thumb-1 (<strong>high code density</strong>) </p>
<p>A multiplexer is used to switch between two states: ARM state (32-bit) and Thumb state (16-bit)</p>
<p><img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202303101536311.png" alt="image-20230310153623263"></p>
<p>thumb要先映射给arm</p>
<h3 id="Thumb-2-instruction-set"><a href="#Thumb-2-instruction-set" class="headerlink" title="Thumb-2 instruction set"></a>Thumb-2 instruction set</h3><p><img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202303101538702.png" alt="image-20230310153840654"></p>
<p>不用选择器</p>
<h3 id="M4-Instructions"><a href="#M4-Instructions" class="headerlink" title="M4 Instructions"></a><strong>M4 Instructions</strong></h3><p>Cortex-M4 processor Supports 32-bit Thumb-2 instructions</p>
<p><img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202303101540540.png"></p>
<p>M4能干M3的事</p>
<h2 id="The-Assembly-Language-Syntax"><a href="#The-Assembly-Language-Syntax" class="headerlink" title="The Assembly Language Syntax"></a><strong>The Assembly Language Syntax</strong></h2><pre class="line-numbers language-assembly" data-language="assembly"><code class="language-assembly">label
	mnemonic operand1, operand2, … ; Comments<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p><strong>label</strong>:optional,reference to an address location（地址位置）</p>
<p>label后为mnemonic(助记符),也就是指令的名称，其后跟着的是多个操作数</p>
<p><strong>operand1</strong>: 目的地</p>
<p><strong>operand2</strong>：源</p>
<p>目的在前源在后</p>
<ul>
<li><p>对于在ARM汇编器中编写的数据处理指令，第一个操作数为操作的目的。</p>
</li>
<li><p>对于存储器读指令(多加载指令除外),第一个操作数为数据被加载进去的寄存器。</p>
</li>
<li><p>对于存储器写指令(多存储指令除外),第一个操作数为保存待写人存储器的数据的寄存器。</p>
</li>
</ul>
<p>mnemonic后面有可能有不同类型的operand，This can result in different instruction encodings</p>
<p>指令中操作数的个数取决于指令的种类，而操作数的语法也可能会各不相同。</p>
<p>Immediate data前缀**#**、</p>
<p><img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202303272308523.png" alt="image-20230327230846454"></p>
<h4 id="Immediate-data（立即数）"><a href="#Immediate-data（立即数）" class="headerlink" title="Immediate data（立即数）"></a>Immediate data（立即数）</h4><p>(prefix with #): a simple way to get data is to make the data part of the instruction</p>
<pre class="line-numbers language-assembly" data-language="assembly"><code class="language-assembly">MOVS R0, #0x12 ; Set R0 = 0x12 (hexadecimal)
MOVS R1, #'A' ; Set R1 = ASCII char A<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h4 id="Suffix"><a href="#Suffix" class="headerlink" title="Suffix"></a><strong>Suffix</strong></h4><p>对于ARM处理器的汇编器，有些指令后会跟着后缀（加在mnemonic后面）。</p>
<p><img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202303101552273.png" alt="image-20230310155250222"></p>
<pre class="line-numbers language-assembly" data-language="assembly"><code class="language-assembly">MOVS R0, R1 ; move R1 into R0, update APSR
MOV R0, R1 ; move R1 into R0, not update APSR<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h4 id="Moving-data-within-the-processor"><a href="#Moving-data-within-the-processor" class="headerlink" title="Moving data within the processor"></a><strong>Moving data within the processor</strong></h4><p>微处理器中最基本的操作是在处理器内部移动数据</p>
<p>• Move data from one register to another </p>
<p>• Move an immediate constant into a register </p>
<pre class="line-numbers language-assembly" data-language="assembly"><code class="language-assembly">; Copy value from R0 to R4
MOV R4, R0 
; Set R3 value to 0x34 and update APSR
MOVS R3, #0x34<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202303101604460.png" alt="image-20230310160440411"></p>
<p><strong>Data Size in Memory Access Instructions</strong></p>
<p>• The default data size for memory access is 32 bits.</p>
<p>• If you wish to transfer 8 bits (1 byte), add suffix B.</p>
<p>• If you wish to transfer 16 bits (2 bytes), add suffix <strong>H</strong>.（half word）</p>
<p>• <strong>If the source data is considered signed and sign extension is needed, suffix by S (for loading)</strong> 只有LDR中的S是sign意思</p>
<pre class="line-numbers language-assembly" data-language="assembly"><code class="language-assembly">LDRSB R0, [R1, #3]		;将内存单元R1+3中的有符号字节数据读取到R0中，R0中高24位设置成该字节数据的符号位
LDRSB R7, [R6, #-1]!	;将内存单元R6-1中的有符号字节数据读取到R7中，R7中高24位设置成该字节数据的符号位，R6 = R6 - 1

<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>LDR指令主要用于储存加载数据到寄存器Rx中，也可以将一个立即数加载到寄存器Rx中，LDR加载<strong>立即数</strong>要使用<strong>“=”</strong>。而不是“#”</p>
<p>LDR从存储器读取数据，STR是将数据写入存储器中。</p>
<pre class="line-numbers language-assembly" data-language="assembly"><code class="language-assembly">; load/store 32 bits to/from R1 from/to memory addr R0
LDR R1, [R0] ;读取地址R0中的数据到R1寄存器中
STR R1, [R0] ;将R1中的值写入到R0中所保存的地址中
; load/store 8 bits, unsigned (padded with 0's)
LDRB R1, [R0] 
STRB R1, [R0]
; load/store 16 bits, signed (signed extended)
LDRSH R1, [R0]
STRH R1, [R0]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>括号的重点是访问内存。可以将其视为C中的*运算符（访问地址的值）</p>
<h4 id="Arithmetic-Operations"><a href="#Arithmetic-Operations" class="headerlink" title="Arithmetic Operations"></a><strong>Arithmetic Operations</strong></h4><p>微控制器的应用通常涉及对数据进行数学计算，以改变程序流程和修改程序动作。</p>
<pre class="line-numbers language-assembly" data-language="assembly"><code class="language-assembly">; R0 = R0 + R1
ADD R0, R0, R1
; R0 = R0 + 0x12 with APSR (flags) update
ADDS R0, R0, #0x12 
; R0 = R1 + R2 + carry 
ADC R0, R1, R2<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>在减法中，进位作为借位，从SBC中的差值中减去。</p>
<pre class="line-numbers language-assembly" data-language="assembly"><code class="language-assembly">; R1 = R3 - R2
SUB R1, R3, R2
; R0 = R1 – 0x26 – not(carry)
SBC R0, R1, #0x26<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-assembly" data-language="assembly"><code class="language-assembly">; R0 = R1 * R2
MUL R0, R1, R2
; R0 = R1 / R2 (unsigned or signed)
UDIV R0, R1, R2
SDIV R0, R1, R2<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>x = 2x – y + 3</p>
<pre class="line-numbers language-assembly" data-language="assembly"><code class="language-assembly">; x in R0; y in R1
LDR R0, =0x0A ; test value x
LDR R1, =0x05 ; test value y
ADDS R0, R0, R0 ; 2x
SUBS R0, R0, R1 ; 2x - y
ADDS R0, R0, #3 ; 2x - y + 3<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="https://chilh.top">chilh</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://chilh.top/post/02-ARM%20Cortex-M4.html">https://chilh.top/post/02-ARM%20Cortex-M4.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://chilh.top" target="_blank">Chilh</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E5%A4%A7%E4%B8%89%E4%B8%8B%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/">大三下课程笔记</a><a class="post-meta__tags" href="/tags/BUPT/">BUPT</a></div><div class="post_share"><div class="social-share" data-image="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202306161931372.webp" data-sites="twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/post/03-C%20as%20Implemented%20in%20Assembly%20Language.html" title="03-C as Implemented in Assembly Language"><img class="cover" src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202306161931372.webp" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">03-C as Implemented in Assembly Language</div></div></a></div><div class="next-post pull-right"><a href="/post/01-introduction.html" title="01- introduction"><img class="cover" src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202306161931372.webp" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">01- introduction</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/post/01%20Introduction.html" title="互联网应用笔记（一）"><img class="cover" src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202306221734670.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-06-20</div><div class="title">互联网应用笔记（一）</div></div></a></div><div><a href="/post/01-introduction.html" title="01- introduction"><img class="cover" src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202306161931372.webp" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-06-16</div><div class="title">01- introduction</div></div></a></div><div><a href="/post/02.5%20linux.html" title="互联网应用笔记（三）"><img class="cover" src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202306221734670.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-06-20</div><div class="title">互联网应用笔记（三）</div></div></a></div><div><a href="/post/02%20stocker%20programming.html" title="互联网应用笔记（二）"><img class="cover" src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202306221734670.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-06-20</div><div class="title">互联网应用笔记（二）</div></div></a></div><div><a href="/post/04%20DHCP.html" title="互联网应用笔记（四）"><img class="cover" src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202306221734670.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-06-20</div><div class="title">互联网应用笔记（四）</div></div></a></div><div><a href="/post/03-C%20as%20Implemented%20in%20Assembly%20Language.html" title="03-C as Implemented in Assembly Language"><img class="cover" src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202306161931372.webp" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-06-16</div><div class="title">03-C as Implemented in Assembly Language</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="waline-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/%E5%A4%B4%E5%83%8F.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">chilh</div><div class="author-info__description">记录学习笔记，学艺不精，大家多多评论指教</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">66</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">17</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">5</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="mailto:1547405085@qq.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#ARM-Cortex-M4"><span class="toc-number">1.</span> <span class="toc-text">ARM Cortex-M4</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#What-is-ARM-Architecture"><span class="toc-number">1.1.</span> <span class="toc-text">What is ARM Architecture?</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Processor-Families"><span class="toc-number">1.1.1.</span> <span class="toc-text">Processor Families</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Design-an-ARM-based-SoC%EF%BC%88%E7%89%87%E4%B8%8A%E7%B3%BB%E7%BB%9F%EF%BC%89"><span class="toc-number">1.1.2.</span> <span class="toc-text">Design an ARM-based SoC（片上系统）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ARM-Cortex-M-Series"><span class="toc-number">1.1.3.</span> <span class="toc-text">ARM Cortex-M Series</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ARM-Processors-vs-ARM-Architectures"><span class="toc-number">1.1.4.</span> <span class="toc-text">ARM Processors vs. ARM Architectures</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#ARM-Cortex-M4-Processor-Overview"><span class="toc-number">1.1.4.1.</span> <span class="toc-text">ARM Cortex-M4 Processor Overview</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#High-Performance-Efficiency"><span class="toc-number">1.1.4.1.1.</span> <span class="toc-text">High Performance Efficiency</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Cortex-M4-Block-Diagram"><span class="toc-number">1.1.4.2.</span> <span class="toc-text">Cortex-M4 Block Diagram</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E4%B8%8E%E6%8C%87%E4%BB%A4"><span class="toc-number">1.2.</span> <span class="toc-text">数据与指令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Registers"><span class="toc-number">1.3.</span> <span class="toc-text">Registers</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Load-store-architecture"><span class="toc-number">1.3.1.</span> <span class="toc-text">Load-store architecture</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Register-bank%EF%BC%88%E5%AF%84%E5%AD%98%E5%99%A8%E7%BB%84%EF%BC%89"><span class="toc-number">1.3.2.</span> <span class="toc-text">Register bank（寄存器组）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#R0%EF%BD%9ER12"><span class="toc-number">1.3.2.1.</span> <span class="toc-text">R0～R12</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#R13-Stack-Pointer-SP"><span class="toc-number">1.3.2.2.</span> <span class="toc-text">R13: Stack Pointer (SP)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#R14-Link-Register-LR"><span class="toc-number">1.3.2.3.</span> <span class="toc-text">R14: Link Register (LR)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#R15-Program-Counter-PC"><span class="toc-number">1.3.2.4.</span> <span class="toc-text">R15: Program Counter (PC)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#xPSR-combined-Program-Status-Register"><span class="toc-number">1.3.2.5.</span> <span class="toc-text">xPSR, combined Program Status Register</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#APSR"><span class="toc-number">1.3.2.5.1.</span> <span class="toc-text">APSR</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#IPSR"><span class="toc-number">1.3.2.5.2.</span> <span class="toc-text">IPSR</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#EPSR"><span class="toc-number">1.3.2.5.3.</span> <span class="toc-text">EPSR</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Interrupt-mask-registers"><span class="toc-number">1.3.2.6.</span> <span class="toc-text">Interrupt mask registers</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#CONTROL-special-register"><span class="toc-number">1.3.2.7.</span> <span class="toc-text">CONTROL: special register</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Cortex-M4-Memory-Map"><span class="toc-number">1.4.</span> <span class="toc-text">Cortex-M4 Memory Map</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Code-Region"><span class="toc-number">1.4.0.0.1.</span> <span class="toc-text">Code Region</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#SRAM-Region"><span class="toc-number">1.4.0.0.2.</span> <span class="toc-text">SRAM Region</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Peripheral-Region%E5%A4%96%E8%AE%BE"><span class="toc-number">1.4.0.0.3.</span> <span class="toc-text">Peripheral Region外设</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#External-RAM-Region"><span class="toc-number">1.4.0.0.4.</span> <span class="toc-text">External RAM Region</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#External-Device-Region"><span class="toc-number">1.4.0.0.5.</span> <span class="toc-text">External Device Region</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Internal-Private-Peripheral-Bus-PPB"><span class="toc-number">1.4.0.0.6.</span> <span class="toc-text">Internal Private Peripheral Bus (PPB)</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Bit-band-Operations"><span class="toc-number">1.4.1.</span> <span class="toc-text">Bit-band Operations</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Benefits-of-Bit-Band-Operations"><span class="toc-number">1.4.1.1.</span> <span class="toc-text">Benefits of Bit-Band Operations</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Cortex-M4-Program-Image"><span class="toc-number">1.4.2.</span> <span class="toc-text">Cortex-M4 Program Image</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Reset-Behaviour"><span class="toc-number">1.4.2.1.</span> <span class="toc-text">Reset Behaviour</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Cortex-M4-Endianness%E5%AD%97%E8%8A%82%E9%A1%BA%E5%BA%8F"><span class="toc-number">1.4.2.2.</span> <span class="toc-text">Cortex-M4 Endianness字节顺序</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ARM-Cortex-M4-Processor-Instruction-Set"><span class="toc-number">1.5.</span> <span class="toc-text">ARM Cortex-M4 Processor Instruction Set</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Mix-of-ARM-and-Thumb-1-Instruction-sets"><span class="toc-number">1.5.1.</span> <span class="toc-text">Mix of ARM and Thumb-1 Instruction sets</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Thumb-2-instruction-set"><span class="toc-number">1.5.2.</span> <span class="toc-text">Thumb-2 instruction set</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#M4-Instructions"><span class="toc-number">1.5.3.</span> <span class="toc-text">M4 Instructions</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#The-Assembly-Language-Syntax"><span class="toc-number">1.6.</span> <span class="toc-text">The Assembly Language Syntax</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Immediate-data%EF%BC%88%E7%AB%8B%E5%8D%B3%E6%95%B0%EF%BC%89"><span class="toc-number">1.6.0.1.</span> <span class="toc-text">Immediate data（立即数）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Suffix"><span class="toc-number">1.6.0.2.</span> <span class="toc-text">Suffix</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Moving-data-within-the-processor"><span class="toc-number">1.6.0.3.</span> <span class="toc-text">Moving data within the processor</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Arithmetic-Operations"><span class="toc-number">1.6.0.4.</span> <span class="toc-text">Arithmetic Operations</span></a></li></ol></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/post/2023%E6%9C%80%E5%90%8E%E4%B8%80%E5%A4%A9%E7%9A%84%E7%95%99%E8%A8%80.html" title="2023最后一天的留言"><img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202312312339644.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="2023最后一天的留言"/></a><div class="content"><a class="title" href="/post/2023%E6%9C%80%E5%90%8E%E4%B8%80%E5%A4%A9%E7%9A%84%E7%95%99%E8%A8%80.html" title="2023最后一天的留言">2023最后一天的留言</a><time datetime="2023-12-31T14:59:00.000Z" title="发表于 2023-12-31 22:59:00">2023-12-31</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/post/%E6%B5%B7%E8%B4%BC%E7%8E%8B%E7%9C%9F%E4%BA%BA%E7%89%88%E8%A7%82%E6%84%9F.html" title="海贼王真人版观感">海贼王真人版观感</a><time datetime="2023-09-07T02:16:37.000Z" title="发表于 2023-09-07 10:16:37">2023-09-07</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/post/ysyx%E9%A2%84%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95-pa1.html" title="ysyx预学习记录--pa1"><img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202308101531521.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="ysyx预学习记录--pa1"/></a><div class="content"><a class="title" href="/post/ysyx%E9%A2%84%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95-pa1.html" title="ysyx预学习记录--pa1">ysyx预学习记录--pa1</a><time datetime="2023-08-10T07:27:15.000Z" title="发表于 2023-08-10 15:27:15">2023-08-10</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/post/DFT-S-OFDM.html" title="DFT-S-OFDM"><img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202307211649897.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="DFT-S-OFDM"/></a><div class="content"><a class="title" href="/post/DFT-S-OFDM.html" title="DFT-S-OFDM">DFT-S-OFDM</a><time datetime="2023-07-21T08:45:03.000Z" title="发表于 2023-07-21 16:45:03">2023-07-21</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/post/%E9%98%BB%E5%A1%9E%E8%B5%8B%E5%80%BC%E5%92%8C%E9%9D%9E%E9%98%BB%E5%A1%9E%E8%B5%8B%E5%80%BC%E7%9A%84%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF.html" title="阻塞赋值和非阻塞赋值的应用场景"><img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202307121444978.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="阻塞赋值和非阻塞赋值的应用场景"/></a><div class="content"><a class="title" href="/post/%E9%98%BB%E5%A1%9E%E8%B5%8B%E5%80%BC%E5%92%8C%E9%9D%9E%E9%98%BB%E5%A1%9E%E8%B5%8B%E5%80%BC%E7%9A%84%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF.html" title="阻塞赋值和非阻塞赋值的应用场景">阻塞赋值和非阻塞赋值的应用场景</a><time datetime="2023-07-12T06:43:44.000Z" title="发表于 2023-07-12 14:43:44">2023-07-12</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202306161931372.webp')"><div id="footer-wrap"><div class="copyright">&copy;2021 - 2023 By chilh</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>function loadWaline () {
  function insertCSS () {
    const link = document.createElement("link")
    link.rel = "stylesheet"
    link.href = "https://cdn.jsdelivr.net/npm/@waline/client/dist/waline.min.css"
    document.head.appendChild(link)
  }

  function initWaline () {
    const waline = Waline.init(Object.assign({
      el: '#waline-wrap',
      serverURL: 'https://chilh-comment-nwkfkyqk8-zhanzghouhe.vercel.app',
      pageview: false,
      dark: 'html[data-theme="dark"]',
      path: window.location.pathname,
      comment: false,
    }, null))
  }

  if (typeof Waline === 'function') initWaline()
  else {
    insertCSS()
    getScript('https://cdn.jsdelivr.net/npm/@waline/client/dist/waline.min.js').then(initWaline)
  }
}

if ('Waline' === 'Waline' || !true) {
  if (true) btf.loadComment(document.getElementById('waline-wrap'),loadWaline)
  else setTimeout(loadWaline, 0)
} else {
  function loadOtherComment () {
    loadWaline()
  }
}</script></div><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-nest.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"model":{"jsonPath":"/live2dw/assets/wanko.model.json"},"display":{"position":"right","width":85,"height":400,"hOffset":-18,"vOffset":25},"mobile":{"show":true},"react":{"opacity":0.7},"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body></html>