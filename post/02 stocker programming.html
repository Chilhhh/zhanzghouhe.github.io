<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>互联网应用笔记（二） | Chilh</title><meta name="author" content="chilh"><meta name="copyright" content="chilh"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="02 stocker programming">
<meta property="og:type" content="article">
<meta property="og:title" content="互联网应用笔记（二）">
<meta property="og:url" content="https://chilh.top/post/02%20stocker%20programming.html">
<meta property="og:site_name" content="Chilh">
<meta property="og:description" content="02 stocker programming">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202306221734670.jpg">
<meta property="article:published_time" content="2023-06-20T11:24:52.000Z">
<meta property="article:modified_time" content="2023-06-22T09:36:44.395Z">
<meta property="article:author" content="chilh">
<meta property="article:tag" content="大三下课程笔记">
<meta property="article:tag" content="BUPT">
<meta property="article:tag" content="互联网应用">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202306221734670.jpg"><link rel="shortcut icon" href="/"><link rel="canonical" href="https://chilh.top/post/02%20stocker%20programming.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"prismjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: true,
    post: true
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":50,"languages":{"author":"作者: chilh","link":"链接: ","source":"来源: Chilh","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#1f1f1f","position":"bottom-left"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  }
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '互联网应用笔记（二）',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-06-22 17:36:44'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><script charset="UTF-8" id="LA_COLLECT" src="//sdk.51.la/js-sdk-pro.min.js"></script><script>LA.init({id:"Jz34H84gllFAWP2o",ck:"Jz34H84gllFAWP2o"})</script><script src="https://sdk.51.la/perf/js-sdk-perf.min.js" crossorigin="anonymous"></script><script> new LingQue.Monitor().init({id:"Jz365mPYN13QqIwT"});</script><script src="https://npm.elemecdn.com/echarts@4.9.0/dist/echarts.min.js"></script><script src="https://npm.elemecdn.com/echarts@4.9.0/map/js/china.js"></script><script src="https://npm.elemecdn.com/echarts@4.9.0/dist/echarts.min.js"></script><meta name="generator" content="Hexo 6.1.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
</head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><script>const preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',()=> { preloader.endLoading() })

if (false) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/%E5%A4%B4%E5%83%8F.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">70</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">20</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">7</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/gallery/"><i class="fa-fw fas fa-camera-retro"></i><span> 图库</span></a></div><div class="menus_item"><a class="site-page" href="/charts/"><i class="fa-fw fa fa-heartbeat"></i><span> 统计</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202306221734670.jpg')"><nav id="nav"><span id="blog-info"><a href="/" title="Chilh"><span class="site-name">Chilh</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/gallery/"><i class="fa-fw fas fa-camera-retro"></i><span> 图库</span></a></div><div class="menus_item"><a class="site-page" href="/charts/"><i class="fa-fw fa fa-heartbeat"></i><span> 统计</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">互联网应用笔记（二）</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-06-20T11:24:52.000Z" title="发表于 2023-06-20 19:24:52">2023-06-20</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-06-22T09:36:44.395Z" title="更新于 2023-06-22 17:36:44">2023-06-22</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%A4%A7%E5%AD%A6%E7%AC%94%E8%AE%B0/">大学笔记</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">5.1k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>24分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="互联网应用笔记（二）"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="Network-Socket-Programming"><a href="#Network-Socket-Programming" class="headerlink" title="Network Socket Programming"></a>Network Socket Programming</h1><h2 id="Introduction-to-NP"><a href="#Introduction-to-NP" class="headerlink" title="Introduction to NP"></a>Introduction to NP</h2><p>Protocol Implementation</p>
<p>◼ TCP/IP</p>
<p>◼ IPX/SPX</p>
<p> Hiding the complexities （隐藏复杂性，用户不用自己操作协议）</p>
<p>◼ Sockets</p>
<p>◼ RPC : Remote Procedure Call（基于socket）</p>
<h2 id="课上environments"><a href="#课上environments" class="headerlink" title="课上environments"></a>课上<em>environments</em></h2><p>◼ TCP/IP nodes on Ethernet</p>
<p>◼ LINUX as the Operating System</p>
<p>◼ C language for most sample programs and assignments</p>
<p><img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202302281005176.png" alt="image-20230228100523099"></p>
<p>网络编程只涉及五层以上，底层kernel support被封装隐藏给用户, 将这些程序发布在以太网中的TCP/IP节点。</p>
<p><strong>这些app会调用系统内核中的接口等</strong> 接口可以理解为库函数</p>
<p><img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202302281006092.png" alt="image-20230228100637018"></p>
<p>Driver是与硬件相连</p>
<p>kernel是性能提升的部分</p>
<h3 id="C-Compiler-in-Linux"><a href="#C-Compiler-in-Linux" class="headerlink" title="C Compiler in Linux"></a><em>C Compiler in Linux</em></h3><pre class="line-numbers language-none"><code class="language-none">% gcc test1.c -o test<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>gcc –o test test.c，将test.c编译并连接成可执行的二进制文件test</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">gcc -g test.c -o test<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>-g表示可以调试</p>
<p>test1.c : program to be compiled</p>
<p>-o : specify the name for running program给可执行文件起名字</p>
<pre class="line-numbers language-none"><code class="language-none">./test<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>运行test</p>
<h3 id="debugger-in-Linux"><a href="#debugger-in-Linux" class="headerlink" title="debugger in Linux"></a><em>debugger in Linux</em></h3><pre class="line-numbers language-none"><code class="language-none">gdb [options] [executable-file [core file or process-id]]<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>◼ file : load the program for debugging</p>
<p>◼ kill : stop the program for debugging</p>
<p>◼ list : list the source code of the program for debugging</p>
<p>​	查看源程序代码，默认显示10行，按回车键继续看余下的</p>
<p>◼ break : set a break point in the source program 加断点</p>
<p>◼ run : run the program to be debugged</p>
<p>​	运行程序直到遇到 结束或者遇到断点等待下一个命令</p>
<p>◼ next : execute <strong>a single line of the program</strong>, but not go into it</p>
<p>◼ step : execute <strong>a single line of the program</strong>, but go into it</p>
<p>◼ quit : quit the gdb to shell 退出gdb</p>
<p>◼ print : display the value of a variable</p>
<p>◼ make : make a run-able program without quiting gdb</p>
<p>◼ c : Continue running your program (e.g. at a breakpoint)</p>
<p>◼ bt (backtrace) : display the program stack</p>
<h2 id="Basic-Concepts"><a href="#Basic-Concepts" class="headerlink" title="Basic Concepts"></a>Basic Concepts</h2><p><strong>Process</strong> ：进程是操作系统正在执行的程序的实例。</p>
<p><strong>System</strong> <strong>Call</strong> Linux/Unix内核提供了有限数量的直接入口点(通常在60到200之间)，活动进程可以通过这些入口点从内核获取服务。</p>
<p><strong>File</strong> <strong>Descriptor</strong> A file descriptor is a small integer used to identify a file that has been opened for I/O operation. Linux 中一切都可以看作文件，包括普通文件、链接文件、Socket 以及设备驱动等，对其进行相关操作时，都可能会创建对应的文件描述符。文件描述符（file descriptor）是内核为了高效管理已被打开的文件所创建的索引，用于指代被打开的文件，对文件所有 I/O 操作相关的系统调用都需要通过文件描述符。</p>
<p><strong>Signal</strong> A signal is a notification to a process that an event has occurred</p>
<p>如 CTRL C停止运行</p>
<h3 id="process"><a href="#process" class="headerlink" title="process"></a><em>process</em></h3><p>One of the most basic abstractions in Unix (the other one is File)</p>
<p><strong>process ≠ program</strong></p>
<ul>
<li><p>Program：a file containing instructions to be executed, static</p>
</li>
<li><p>Process:  an instance of a program in execution, live entity</p>
</li>
</ul>
<p>**One program can have multiple processes 、invoke multiple programs **并发</p>
<p><img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202302281032496.png" alt="image-20230228103215402"></p>
<ul>
<li><p>Text: program code</p>
</li>
<li><p>Data: global variables</p>
</li>
<li><p>Heap: dynamic allocated memory, **malloc()**动态分配内存，放在堆中</p>
</li>
<li><p>Stack: temporary data (local variable, function parameters, return addresses)</p>
</li>
</ul>
<h4 id="PID-Process-ID"><a href="#PID-Process-ID" class="headerlink" title="PID (Process ID)"></a>PID (Process ID)</h4><p>标识进程：The PID is an integer, typically in the range 0 through 32,767. 每个进程都有一个唯一的PID</p>
<p>每一个进程有父进程</p>
<p>PPID (Parent PID): Every process has a parent process ID.父进程ID</p>
<p><strong>Special process</strong></p>
<p>◼ PID = 1: init process</p>
<p>◼ PID = 0: special kernel process (e.g., idle/swapper process)</p>
<p>◼ PID = 2: special kernel process (e.g., page daemon process)</p>
<pre class="line-numbers language-none"><code class="language-none">ps –ef<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><strong>see every process on the system</strong>（本身也是一个process）</p>
<p><img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202302281043110.png" alt="image-20230228104338070"></p>
<p>kill PID 杀掉进程/CTRL c</p>
<h4 id="Related-system-calls"><a href="#Related-system-calls" class="headerlink" title="Related system calls"></a>Related system calls</h4><p>fork(): to create a child process （父进程的拷贝）</p>
<p>getpid(): to obtain the PID of a process（当前进程的PID）</p>
<p>getppid(): to obtain the PPID(Parent Process ID) of a process（当前进程的父进程PID）</p>
<p>exec(): often used after fork() to load another process（改变子进程）</p>
<p>​	<strong>execl(), execv(), execle(), execve(), execlp(), execvp()</strong></p>
<p>exit(): to terminate a process and release all the resources </p>
<h4 id="fork"><a href="#fork" class="headerlink" title="fork()"></a>fork()</h4><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/types.h&gt;</span></span>
<span class="token comment">//是Unix/Linux系统的基本系统数据类型的头文件，含有size_t，time_t，pid_t等类型。</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h&gt;</span></span>
<span class="token comment">//是 C 和 C++ 程序设计语言中提供对 POSIX 操作系统 API 的访问功能的头文件的名称。</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h&gt;</span></span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token class-name">pid_t</span> t<span class="token punctuation">;</span>        
    <span class="token comment">//typedef int pid_t linux里的int</span>
	t<span class="token operator">=</span><span class="token function">fork</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//返回子进程进程号，子进程里t为0</span>
   <span class="token comment">//fork()之后的代码会在父子进程都跑一遍</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"fork returned %d\n"</span><span class="token punctuation">,</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>创建一个进程，所创建的进程复制父进程的<strong>代码段/数据段/BSS段/堆/栈等所有用户空间信息</strong></p>
<h5 id="fork-特性"><a href="#fork-特性" class="headerlink" title="fork()特性"></a>fork()特性</h5><p>fork调用的一个奇妙之处就是它仅仅被调用一次，却能够返回两次，它可能有三种不同的返回值：</p>
<ol>
<li><p>在父进程中，fork返回新创建子进程的进程ID；</p>
</li>
<li><p>在子进程中，fork返回0；</p>
</li>
<li><p>如果出现错误，fork返回一个负值；</p>
<p>可以通过fork返回的值来判断当前进程是子进程还是父进程</p>
</li>
</ol>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">$ gcc fork1.c –o fork1
$ ./fork1
fork returned 0 #子进程结果
fork returned 22770 #父进程结果<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p><strong>fork 调用生成的新进程与其父进程谁先执行不一定，哪个进程先执行要看系统的进程调度策略</strong></p>
</blockquote>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/types.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token keyword">int</span> <span class="token function">main</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token class-name">pid_t</span> t<span class="token punctuation">;</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Original program, pid=%d\n"</span><span class="token punctuation">,</span> <span class="token function">getpid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	t <span class="token operator">=</span> <span class="token function">fork</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>t <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        #子进程执行
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"In child process, pid=%d, ppid=%d\n"</span><span class="token punctuation">,</span><span class="token function">getpid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">getppid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
			<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"In parent, pid=%d, fork returned=%d\n"</span><span class="token punctuation">,</span><span class="token function">getpid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> t<span class="token punctuation">)</span><span class="token punctuation">;</span>
        #父进程自己id<span class="token operator">+</span>子进程ID
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>结果</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">Original program, pid=987
In child process, pid=988, ppid=987
In parent, pid=987, fork returned=988 #子进程进程号<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h4 id="exec"><a href="#exec" class="headerlink" title="exec()"></a>exec()</h4><p>用法：<img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202303211928241.png" alt="image-20230321192853166"></p>
<p>Sample program of exec() – exec1.c</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token keyword">int</span> <span class="token function">main</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">char</span> <span class="token operator">*</span>arg<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token string">"/bin/ls"</span><span class="token punctuation">,</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token comment">//字符串数组（路径）0字符结尾（null结尾） 先在另一个窗口运行ls process</span>
    <span class="token comment">//char *arg[] = { "/bin/ls","-l", 0 };带参数的写法</span>
	<span class="token comment">/* fork, and exec within child process */</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">fork</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">//子进程</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"In child process:\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">execv</span><span class="token punctuation">(</span>arg<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> arg<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//从此开始子进程执行ls，第二参数指针：读取参数</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"I will never be called\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//在子进程不会执行</span>
	<span class="token punctuation">}</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Execution continues in parent process\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[shiyan@localhost examples-for-ia]$ ./exec1
In child process:
Execution continues in parent process
[shiyan@localhost examples-for-ia]$ exec1 exec1.c #ls
fork1 fork1.c fork2 fork2.c<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>exec:</strong> <strong>将新程序代码加载（拷贝）到子进程的内存空间，替换掉原有的与父进程一模一样的代码和数据，让子进程空间运行全新的程序。</strong></p>
<h3 id="file-descriptor"><a href="#file-descriptor" class="headerlink" title="file descriptor"></a><em>file descriptor</em></h3><p>File descriptors are assigned by the kernel when the following system calls are successful</p>
<p>文件描述符(整数)在打开或创建文件时返回，并在以后读取或写入文件时用作参数</p>
<p><img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202302281118608.png" alt="image-20230228111820559"></p>
<p>对文件操作&lt;unistd.h&gt;</p>
<p>对字符流操作&lt;stdio.h&gt;</p>
<h4 id="open"><a href="#open" class="headerlink" title="open"></a>open</h4><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">open</span> <span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span>pathname<span class="token punctuation">,</span> <span class="token keyword">int</span> oflag<span class="token punctuation">,</span> <span class="token keyword">int</span> mode<span class="token punctuation">)</span><span class="token punctuation">;</span> <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>pathname：Name of the file</p>
<p>oflag：打开文件的方式：O_RDONLY O_WRONLY O_RDWR</p>
<p>mode：when creating a file to indicate the access authority</p>
<p>return：<strong>File descriptor</strong> or -1</p>
<h4 id="close"><a href="#close" class="headerlink" title="close"></a>close</h4><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">close</span> <span class="token punctuation">(</span><span class="token keyword">int</span> filedes<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>filedes：File descriptor </p>
<p>return：0 or -1</p>
<h4 id="read"><a href="#read" class="headerlink" title="read"></a>read</h4><p>Be used to reading the data from an opened file</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">read</span> <span class="token punctuation">(</span><span class="token keyword">int</span> filedes<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>buff<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> <span class="token keyword">int</span> nbytes<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>filedes：为要读取的文件的File descriptor </p>
<p>buff: 指向存放该函数返回内容的内存的指针</p>
<p>nbytes: 读的字节数</p>
<p>return： <strong>0读完了</strong>，-1失败 其他表示写入的字符数</p>
<h4 id="write"><a href="#write" class="headerlink" title="write"></a>write</h4><p>Be used to writing data into an opened file</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">write</span> <span class="token punctuation">(</span><span class="token keyword">int</span> filedes<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>buff<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> <span class="token keyword">int</span> nbytes<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>fd:是文件描述符（输出到command line，就是1）</p>
<p>buf:通常是一个字符串，需要写入的字符串</p>
<h4 id="lseek-改变文件偏移量"><a href="#lseek-改变文件偏移量" class="headerlink" title="lseek 改变文件偏移量"></a>lseek 改变文件偏移量</h4><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">long</span> <span class="token function">lseek</span> <span class="token punctuation">(</span><span class="token keyword">int</span> filedes<span class="token punctuation">,</span> <span class="token keyword">long</span> offset<span class="token punctuation">,</span> <span class="token keyword">int</span> whence<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>offset：文件偏移量（offset为负值表示往前偏移，正值则表示往后偏移）</p>
<p><strong>whence（偏移方式 起始点）</strong>： </p>
<ol>
<li>SEEK_SET表示从文件开头位置往后移动offset个字节，且offset只能为正数，如果offset为负数是没有意义的。</li>
</ol>
<p>  2. SEEK_CUR表示从当前文件的位置往前或往后移动offset个字节，如果offset为正数则表示往后移动，为负数则表示往前移动。<br>  3. SEEK_END表示从文件末尾的位置往前或往后移动offset个字节，如果offset为正数则表示往后移动为负数则表示往前移动。</p>
<h4 id="dup"><a href="#dup" class="headerlink" title="dup"></a>dup</h4><p>Be used to duplicate a file descriptor 复制一个和filedesc指向同一个文件的文件描述符</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">dup</span> <span class="token punctuation">(</span><span class="token keyword">int</span> filedes<span class="token punctuation">)</span><span class="token punctuation">;</span> 参数旧文件，返回新文件
<span class="token keyword">int</span> <span class="token function">dup2</span> <span class="token punctuation">(</span><span class="token keyword">int</span> filedes<span class="token punctuation">,</span> <span class="token keyword">int</span> filedes2<span class="token punctuation">)</span><span class="token punctuation">;</span> 参数旧文件 新文件<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h4 id="fcntl"><a href="#fcntl" class="headerlink" title="fcntl"></a>fcntl</h4><p>Be used to change the properties of the file that is already open</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">fcntl</span> <span class="token punctuation">(</span><span class="token keyword">int</span> filedes<span class="token punctuation">,</span> <span class="token keyword">int</span> cmd<span class="token punctuation">,</span> <span class="token keyword">int</span> arg<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202302281132139.png" alt="image-20230228113256089"></p>
<h4 id="File-Permissions"><a href="#File-Permissions" class="headerlink" title="File Permissions"></a>File Permissions</h4><ul>
<li><p>r-read, w-write, x-execute 三个代表三位（每一位都对应一种操作：read, write and execute）Three bits can be used to define the permission for one kind of user</p>
</li>
<li><p>binary number 111 means the user has permission to <strong>read, write and execute</strong> the file</p>
<p> 100 means <strong>the user only can read the file</strong></p>
</li>
<li><p>Three kinds of users（需要定义三种用户的权限）: </p>
<p><strong>u-user, g–group, O-other</strong></p>
<p>Three numbers for user, group, other</p>
</li>
<li><p>For example, 644 (octal) means </p>
<p>◼ user: 110 (binary), read&amp;write</p>
<p>◼ group: 100 (binary), read</p>
<p>◼ other：100 (binary), read</p>
</li>
</ul>
<p>一般前面加个0：0777</p>
<h5 id="Sample-program-of-lseek-–-lseek1-c"><a href="#Sample-program-of-lseek-–-lseek1-c" class="headerlink" title="Sample program of lseek() – lseek1.c"></a>Sample program of lseek() – lseek1.c</h5><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/types.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;fcntl.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h&gt;</span></span>

<span class="token keyword">char</span> buf1<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">"abcdefghij"</span><span class="token punctuation">;</span>
<span class="token keyword">char</span> buf2<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">"ABCDEFGHIJ"</span><span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">FILE_MODE</span> <span class="token expression"><span class="token number">0644</span> </span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token keyword">int</span> fd<span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>fd<span class="token operator">=</span><span class="token function">creat</span><span class="token punctuation">(</span><span class="token string">"file.hole"</span><span class="token punctuation">,</span>FILE_MODE<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">&lt;</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment">//（文件名，权限）</span>
<span class="token punctuation">{</span> 	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"creat error\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span>
 <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">write</span><span class="token punctuation">(</span>fd<span class="token punctuation">,</span>buf1<span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token operator">!=</span><span class="token number">10</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span> 	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"buf1 write error\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span>
    <span class="token comment">/*offset now = 10 */</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">lseek</span><span class="token punctuation">(</span>fd<span class="token punctuation">,</span><span class="token number">40</span><span class="token punctuation">,</span><span class="token constant">SEEK_SET</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span> 	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"lseek error\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span>
	<span class="token comment">/*offset now = 40 */</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">write</span><span class="token punctuation">(</span>fd<span class="token punctuation">,</span>buf2<span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token operator">!=</span><span class="token number">10</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span> 	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"buf2 write error\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span>
    <span class="token comment">/*offset now = 50 */</span>
	<span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li><p>od command 看文件的内容</p>
<p>◼ be used to display the content of the file</p>
<p>◼ -c: display in character format</p>
<p>0644对于下红框rw r r</p>
<p><img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202302281559512.png" alt="image-20230228114454019"></p>
</li>
</ul>
<p>\0就是没有写入的内存</p>
<p>当使用lseek时，文件的偏移量可以大于文件的长度。因此，下一个写入操作将扩展文件，并在文件内部创建一个洞</p>
<h5 id="Sample-program-of-read-and-write-–-readwrite1-c"><a href="#Sample-program-of-read-and-write-–-readwrite1-c" class="headerlink" title="Sample program of read() and write() – readwrite1.c"></a>Sample program of read() and write() – readwrite1.c</h5><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;fcntl.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">char</span> quit<span class="token operator">=</span><span class="token char">'.'</span><span class="token punctuation">;</span>
	<span class="token keyword">char</span> buf<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token keyword">int</span> fd<span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>fd <span class="token operator">=</span> <span class="token function">open</span><span class="token punctuation">(</span><span class="token string">"out.out"</span><span class="token punctuation">,</span>O_RDWR <span class="token operator">|</span> O_CREAT<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token comment">//O_RDWR 文件可读可写</span>
        <span class="token comment">//O_CREAT调用create创建</span>
			<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Error in opening\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">while</span><span class="token punctuation">(</span>buf<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">!=</span>quit<span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
			<span class="token function">read</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>buf<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//'0'代表从键盘读</span>
			<span class="token function">write</span><span class="token punctuation">(</span>fd<span class="token punctuation">,</span>buf<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token function">write</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>buf<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//‘1’代表输出到命令行</span>
	<span class="token punctuation">}</span>
	<span class="token function">close</span><span class="token punctuation">(</span>fd<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>chmod 777 name.txt代表把所有权限打开</p>
<h3 id="signal"><a href="#signal" class="headerlink" title="signal"></a><em>signal</em></h3><p>Signals are some time called “Software interrupts”</p>
<p>信号可以从一个进程发送到另一个进程，也可以从内核发送到一个进程</p>
<p>头文件 &lt;signal.h&gt;</p>
<p>The names of the signals begin with SIG</p>
<p>◼ SIGALRM: alarm clock timeout</p>
<p>◼ SIGINT: Interrupt character (Ctrl-C) is typed</p>
<p><img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202302281610501.png" alt="image-20230228161053431"></p>
<p><img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202302281617447.png" alt="image-20230228161708272"></p>
<h2 id="Client-server-model"><a href="#Client-server-model" class="headerlink" title="Client-server model"></a>Client-server model</h2><p><img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202302281638308.png" alt="image-20230228163853250"></p>
<p>Most of network applications are based on the client-server model:</p>
<p>◼ A <strong>server</strong> process and one or more <strong>client</strong> processes</p>
<p>◼ Server manages some <strong>resources</strong>.</p>
<p>◼ Server provides <strong>service</strong> by manipulating resources for clients.</p>
<p><img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202302281642143.png" alt="image-20230228164218084"></p>
<p><img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202302281643695.png" alt="image-20230228164322633"></p>
<p>线上是应用程序，线下是操作系统</p>
<p>Connections are end-to-end, full-duplex (2- way communication), and reliable.</p>
<p>标识进程：端口号和ip</p>
<p><img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202302281644994.png" alt="image-20230228164458890"></p>
<h4 id="Servers"><a href="#Servers" class="headerlink" title="Servers"></a>Servers</h4><p>Servers are long-running processes (daemons).</p>
<p>◼ Typically created at boot-time by the <strong>init process</strong> (pid=1)</p>
<p>◼ Run continuously until the machine is turned off </p>
<p><img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202302281647688.png" alt="image-20230228164707631"></p>
<h4 id="Useful-Unix-Commands"><a href="#Useful-Unix-Commands" class="headerlink" title="Useful Unix Commands"></a>Useful Unix Commands</h4><h5 id="netstat"><a href="#netstat" class="headerlink" title="netstat"></a>netstat</h5><p>打印有关Linux网络子系统的信息，例如网络连接、路由表、接口统计信息等</p>
<p>◼ netstat</p>
<p>​		 Displays a list of open sockets.</p>
<p>◼ netstat -i</p>
<p>​			Display the information about the network interfaces</p>
<p>◼ netstat -ni</p>
<p>​			 Display the information about the network interfaces using numeric addresses</p>
<p>◼ netstat -r</p>
<p>​			 Display the kernel routing tables</p>
<p>◼ netstat -nr</p>
<p>​				Display the kernel routing tables using numeric addresses</p>
<p><img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202302281654887.png" alt="image-20230228165420828"></p>
<p><img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202302281654472.png" alt="image-20230228165434425"></p>
<p>eth0:以太网接口</p>
<p> lo：回环地址指向本机</p>
<p><img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202302281655357.png" alt="image-20230228165552274"></p>
<h5 id="ifconfig"><a href="#ifconfig" class="headerlink" title="- ifconfig"></a>- ifconfig</h5><p>配置网口，通常用于打印网口的配置信息（windows: ipconfig)</p>
<p><img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202302281656119.png" alt="image-20230228165637065"></p>
<h5 id="ping"><a href="#ping" class="headerlink" title="ping"></a>ping</h5><p>Functions: Sends a packet to the host specified by destination and prints out the roundtrip time ( Using ICMP messages)</p>
<p><img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202302281700005.png" alt="image-20230228170031947"></p>
<h2 id="Structures-about-IP-address-and-DNS"><a href="#Structures-about-IP-address-and-DNS" class="headerlink" title="Structures about  IP address and DNS"></a>Structures about  IP address and DNS</h2><h3 id="IP-Addresses"><a href="#IP-Addresses" class="headerlink" title="IP Addresses"></a>IP Addresses</h3><p>Hosts are mapped to a set of 32-bit <em>IP addresses</em>.</p>
<ul>
<li>202.112.96.163 点分十进制</li>
</ul>
<p>The set of IP addresses is mapped to a set of identifiers called Internet <em>domain names</em></p>
<ul>
<li>202.112.96.163 is mapped to <a target="_blank" rel="noopener" href="http://www.bupt.edu.cn/">www.bupt.edu.cn</a></li>
</ul>
<blockquote>
<p>32-bit IP addresses are stored in an <em>IP Address structure</em></p>
<p>用结构体定义</p>
</blockquote>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token comment">/* Internet address. */</span>
<span class="token keyword">typedef</span> <span class="token class-name">uint32_t</span> <span class="token class-name">in_addr_t</span><span class="token punctuation">;</span>
<span class="token keyword">struct</span> <span class="token class-name">in_addr</span> <span class="token punctuation">{</span>
<span class="token class-name">in_addr_t</span> s_addr<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>



uint32<span class="token operator">:</span>
<span class="token comment">/*Defined in &lt;stdint.h&gt;*/</span>
<span class="token keyword">typedef</span> <span class="token keyword">unsigned</span> <span class="token keyword">int</span> <span class="token class-name">uint32_t</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="Two-ways-to-store-multi-byte-integers"><a href="#Two-ways-to-store-multi-byte-integers" class="headerlink" title="Two ways to store multi-byte integers"></a><strong>Two ways to store multi-byte integers</strong></h4><p>大端和小端</p>
<p><img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202303141004543.png" alt="image-20230314100420469"></p>
<p>little 先存低位（低位低地址，高位存高地址）</p>
<p>big 先存高位（高位低地址，低位高地址）</p>
<p>发端和收端存储方式不同：数据颠倒：0102-&gt;0201</p>
<h4 id="Host-byte-order-vs-network-byte-order"><a href="#Host-byte-order-vs-network-byte-order" class="headerlink" title="Host byte order vs. network byte order"></a>Host byte order vs. network byte order</h4><p><strong>Host byte order（主机字节序）</strong> is machine-dependent （定义big or little）</p>
<p> in &lt;bits/endian.h&gt; 中定义</p>
<p><strong>Network byte order（网络字节序）</strong> is machine-independent (<em>big-endian</em>)强制的</p>
<p>发数据前先把主机字节序转换为网络字节序，防止不一致</p>
<h5 id="转换的函数"><a href="#转换的函数" class="headerlink" title="转换的函数"></a>转换的函数</h5><p>◼ <strong>htonl</strong>（L对应Long int：四个字节，对应转换ip长度）: host byte order → network byte order for <strong>long int</strong></p>
<p>◼ <strong>htons</strong>（s对应short int: 2个字节，对应转换端口号）: host byte order → network byte order for <strong>short int</strong></p>
<p>◼ <strong>ntohl</strong>: network byte order → host byte order for <strong>long int</strong> </p>
<p>◼ <strong>ntohs</strong>: network byte order → host byte order for <strong>short int</strong></p>
<p>判断本机是little还是big</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/types.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h&gt;</span></span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token keyword">union</span> <span class="token punctuation">{</span>
				<span class="token keyword">short</span> s<span class="token punctuation">;</span>
				<span class="token keyword">char</span> c<span class="token punctuation">[</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">short</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">//一个字符是一个字节</span>
		<span class="token punctuation">}</span>un<span class="token punctuation">;</span>
    <span class="token comment">//union:所有成员（s和c）共享存储空间 means only one of them can be used at a time</span>
		un<span class="token punctuation">.</span>s<span class="token operator">=</span><span class="token number">0x0102</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">short</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">{</span> 
			<span class="token keyword">if</span> <span class="token punctuation">(</span>un<span class="token punctuation">.</span>c<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token number">1</span> <span class="token operator">&amp;&amp;</span>un<span class="token punctuation">.</span>c<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token number">2</span><span class="token punctuation">)</span>
				<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"big-endian\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>un<span class="token punctuation">.</span>c<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token number">2</span> <span class="token operator">&amp;&amp;</span>un<span class="token punctuation">.</span>c<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token number">1</span><span class="token punctuation">)</span>
				<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"littlt-endian\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">else</span>
				<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Unknow\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token keyword">else</span>
			<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"sizeof(short)=%d\n"</span><span class="token punctuation">,</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">short</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202303141027930.png" alt="image-20230314102722868"></p>
<p>short: 2byte</p>
<p>char: 1byte</p>
<h3 id="Domain-Name-System"><a href="#Domain-Name-System" class="headerlink" title="Domain Name System"></a>Domain Name System</h3><p><em>DNS</em>:<em>host entry structures</em>(服务器返回的结构体)</p>
<p>定义在 &lt;netdb.h&gt;</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token comment">/* Description of data base entry for a single host. */</span>
<span class="token keyword">struct</span> <span class="token class-name">hostent</span>
<span class="token punctuation">{</span>
	<span class="token keyword">char</span> <span class="token operator">*</span>h_name<span class="token punctuation">;</span> <span class="token comment">//字符串/* Official name of host. */</span>
	<span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>h_aliases<span class="token punctuation">;</span><span class="token comment">//字符串数组  /* Alias（别名） list. */</span>
	<span class="token keyword">int</span> h_addrtype<span class="token punctuation">;</span> <span class="token comment">/* Host address type. V4 or V6 */</span>
	<span class="token keyword">int</span> h_length<span class="token punctuation">;</span> <span class="token comment">/* Length of address. */</span>
	<span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>h_addr_list<span class="token punctuation">;</span><span class="token comment">//地址列表（一个域名对应很多个ip） /* List of addresses from name server.*/</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">h_addr</span> <span class="token expression">h_addr_list<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> </span><span class="token comment">/* The first address in 
the address list. */</span></span>
<span class="token punctuation">}</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p><img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202303141042442.png" alt="image-20230314104248380"></p>
<p>字符串\0结尾，字符串数组最后一位位null</p>
<p><img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202303141044188.png" alt="image-20230314104459129"></p>
<h4 id="调用函数"><a href="#调用函数" class="headerlink" title="调用函数"></a>调用函数</h4><ul>
<li><p><strong>gethostbyname</strong>: query key is a DNS domain name</p>
<p>*<em>gethostbyname (const char <em>hostname)</em></em></p>
</li>
</ul>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;netdb.h&gt;</span></span>
<span class="token keyword">struct</span> <span class="token class-name">hostent</span> <span class="token operator">*</span> <span class="token function">gethostbyname</span> <span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>hostname<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>​	返回结构体的指针</p>
<ul>
<li><strong>gethostbyaddr</strong>： query key is an IP address.</li>
</ul>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;netdb.h&gt;</span></span>
<span class="token keyword">struct</span> <span class="token class-name">hostent</span> <span class="token operator">*</span> <span class="token function">gethostbyaddr</span> <span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>addr<span class="token punctuation">,</span> <span class="token keyword">int</span> len<span class="token punctuation">,</span> <span class="token keyword">int</span> family <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//地址，长度，协议族（AF_INET for IPv4）</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h2 id="Socket-Interface"><a href="#Socket-Interface" class="headerlink" title="Socket Interface"></a>Socket Interface</h2><h3 id="What-is-a-socket"><a href="#What-is-a-socket" class="headerlink" title="What is a socket?"></a>What is a socket?</h3><p>◼ To the kernel, a socket is an endpoint of communication.</p>
<p>◼ To an application, a socket is a <strong>file descriptor</strong> that lets the application read/write from/to the network.</p>
<p> <strong>All Unix I/O devices, including networks, are modeled as files</strong></p>
<p>◼ Clients and servers communicate with each other by reading from and writing to <strong>socket descriptors</strong></p>
<p><img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202303141052805.png" alt="image-20230314105255754"></p>
<p>0 1 2保留，每个stocket创建给一个描述符</p>
<h4 id="Internet-specific-socket-address-bits-x2F-socket-h"><a href="#Internet-specific-socket-address-bits-x2F-socket-h" class="headerlink" title="Internet-specific socket address (bits/socket.h)"></a><strong>Internet-specific</strong> <strong>socket address</strong> (bits/socket.h)</h4><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">struct</span> <span class="token class-name">sockaddr_in</span> <span class="token punctuation">{</span>
	<span class="token keyword">unsigned</span> <span class="token keyword">short</span> sin_family<span class="token punctuation">;</span> <span class="token comment">/* 协议族 address family (always AF_INET) */</span>
	<span class="token keyword">unsigned</span> <span class="token keyword">short</span> sin_port<span class="token punctuation">;</span> <span class="token comment">/* 端口port num in network byte order（必须为网络字节序） */</span>
	<span class="token keyword">struct</span> <span class="token class-name">in_addr</span> sin_addr<span class="token punctuation">;</span> <span class="token comment">/* IP地址iP addr in network byte order */</span>
	<span class="token keyword">unsigned</span> <span class="token keyword">char</span> sin_zero<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">/* pad to sizeof(struct sockaddr) */</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>一共占16字节</p>
<p><strong>Address family</strong>: 域是指通信进程存在的区域。</p>
<p><img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202303141056865.png" alt="image-20230314105658816"></p>
<h4 id="Generic-socket-address-lt-sys-x2F-socket-h-gt"><a href="#Generic-socket-address-lt-sys-x2F-socket-h-gt" class="headerlink" title="Generic socket address (<sys/socket.h>)"></a><strong>Generic</strong> <strong>socket address</strong> (&lt;sys/socket.h&gt;)</h4><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">struct</span> <span class="token class-name">sockaddr</span> <span class="token punctuation">{</span>
	<span class="token keyword">unsigned</span> <span class="token keyword">short</span> sa_family<span class="token punctuation">;</span> <span class="token comment">/* protocol family */</span>
	<span class="token keyword">char</span> sa_data<span class="token punctuation">[</span><span class="token number">14</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">/* protocol-specific address, up to 14 bytes. */</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>16字节</p>
<p><img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202303141058886.png" alt="image-20230314105858837"></p>
<p>PF开头</p>
<p>多个stock通信的一些函数（**connect(), bind() and accept()**）Gneric socket</p>
<p>Must cast Internet-specific socket address (sockaddr_in *) to generic socket address (sockaddr *) for connect, bind, and accept</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">struct</span> <span class="token class-name">sockaddr_in</span> serv<span class="token punctuation">;</span>
<span class="token comment">/* fill in serv{}*/</span>
<span class="token function">bind</span> <span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">sockaddr</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>serv <span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>serv<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//struct sockaddr *是指针类型，所以也要用&amp;获取serv的指针</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h5 id="对比"><a href="#对比" class="headerlink" title="对比"></a>对比</h5><p><img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202303141106043.png" alt="image-20230314110612950"></p>
<h3 id="Sockets-Interface"><a href="#Sockets-Interface" class="headerlink" title="Sockets Interface"></a>Sockets Interface</h3><h4 id="Stream-Socket"><a href="#Stream-Socket" class="headerlink" title="Stream Socket"></a>Stream Socket</h4><p>Service: reliable (i.e. sequenced, non-duplicated, non-corrupted) bidirectional delivery of byte-stream data</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> s <span class="token operator">=</span> <span class="token function">socket</span> <span class="token punctuation">(</span>PF_INET<span class="token punctuation">,</span> SOCK_STREAM<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>s是stocket描述符</p>
<h4 id="Datagram-Socket"><a href="#Datagram-Socket" class="headerlink" title="Datagram Socket"></a>Datagram Socket</h4><p>Service: unreliable, unsequenced datagram</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> s <span class="token operator">=</span> <span class="token function">socket</span> <span class="token punctuation">(</span>PF_INET<span class="token punctuation">,</span> SOCK_DGRAM<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h4 id="Raw-Sockets-Service"><a href="#Raw-Sockets-Service" class="headerlink" title="Raw Sockets Service"></a>Raw Sockets Service</h4><p>原始stocket</p>
<p>设计底层时，通过这个可以改底层服务</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> s <span class="token operator">=</span> <span class="token function">socket</span> <span class="token punctuation">(</span>PF_INET<span class="token punctuation">,</span> SOCK_RAW<span class="token punctuation">,</span> protocol<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h4 id="Reliably-delivered-Message-Socket"><a href="#Reliably-delivered-Message-Socket" class="headerlink" title="Reliably-delivered Message Socket"></a>Reliably-delivered Message Socket</h4><p>Similar to datagram socket but ensure the arrival of the datagrams（UDP加一点可靠性）</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> s <span class="token operator">=</span> <span class="token function">socket</span> <span class="token punctuation">(</span>PF_NS<span class="token punctuation">,</span> SOCK_RDM<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h4 id="Sequenced-Packet-Stream-Socket"><a href="#Sequenced-Packet-Stream-Socket" class="headerlink" title="Sequenced Packet Stream Socket"></a>Sequenced Packet Stream Socket</h4><p>Similar to stream socket but using <strong>fixed-size datagrams</strong></p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> s <span class="token operator">=</span> <span class="token function">socket</span> <span class="token punctuation">(</span>PF_NS<span class="token punctuation">,</span> SOCK_SEQPACKET<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h2 id="Major-System-Calls"><a href="#Major-System-Calls" class="headerlink" title="Major System Calls"></a>Major System Calls</h2><p>A network application works as follows:</p>
<p>◼ An endpoint (telephone) for communication is created on both ends.</p>
<p>◼ An address (phone no) is assigned to both ends to distinguish them from the rest of the network.</p>
<p>◼ One of the endpoint (receiver) waits for the communication to start.</p>
<p>◼ The other endpoint (caller) <strong>initiates a connection</strong>.</p>
<p>◼ Once the call has been accepted, a connection is made and data is exchanged (talk).</p>
<p>◼ Once data has been exchanged the endpoints are closed (hang up).</p>
<p><img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202303141117243.png" alt="image-20230314111743184"></p>
<h3 id="Socket-Operation"><a href="#Socket-Operation" class="headerlink" title="Socket Operation"></a>Socket Operation</h3><p><img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202303141119958.png" alt="image-20230314111917906"></p>
<p>connect() listen() accept()只有tcp有</p>
<p>close() and shutdown()：</p>
<ul>
<li><p>close（）：四次挥手，双向关闭</p>
</li>
<li><p>shutdown()：只关发送不关接收</p>
</li>
</ul>
<h3 id="Byte-Order-Conversion"><a href="#Byte-Order-Conversion" class="headerlink" title="Byte Order Conversion"></a>Byte Order Conversion</h3><p><img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202303141122769.png" alt="image-20230314112222711"></p>
<h3 id="Address-Formats-Conversion"><a href="#Address-Formats-Conversion" class="headerlink" title="Address Formats Conversion"></a>Address Formats Conversion</h3><ul>
<li><p><strong>inet_aton()</strong></p>
<p>IP address in numbers-and-dots notation (ASCII string) → IP address structure in network byte order 把字符串地址转为结构体</p>
</li>
<li><p><strong>inet_addr()</strong></p>
</li>
</ul>
<p>  same function with inet_aton()</p>
<ul>
<li><p><strong>inet_ntoa()</strong></p>
<p> IP address structure in network byte order → IP address in numbers-and-dots notation (ASCII string)</p>
</li>
</ul>
<img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202303141131559.png" alt="image-20230314113157508" style="zoom:67%;">

<p>不要求</p>
<h3 id="Socket-Option"><a href="#Socket-Option" class="headerlink" title="Socket Option"></a>Socket Option</h3><p><img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202303141132664.png" alt="image-20230314113232615"></p>
<h3 id="Name-and-Address-OperationA"><a href="#Name-and-Address-OperationA" class="headerlink" title="Name and Address OperationA"></a>Name and Address OperationA</h3><p><img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202303141133540.png" alt="image-20230314113317487"></p>
<h3 id="Process-of-Socket-Operation-TCP-Operations"><a href="#Process-of-Socket-Operation-TCP-Operations" class="headerlink" title="Process of Socket Operation:TCP Operations"></a>Process of Socket Operation:TCP Operations</h3><p><img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202303141134790.png" alt="image-20230314113415735"></p>
<p>紫色对应三次握手</p>
<p><img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202303141136758.png" alt="image-20230314113609695"></p>
<h4 id="socket"><a href="#socket" class="headerlink" title="socket()"></a>socket()</h4><p> create a new socket </p>
<p>that can be used for network communication</p>
<p><img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202303141143933.png" alt="image-20230314114320877"></p>
<h4 id="bind"><a href="#bind" class="headerlink" title="bind()"></a>bind()</h4><p>An application calls bind() to specify the local endpoint address (a <strong>local</strong> <strong>IP address and protocol port number</strong>) for a socket（服务器的地址和端口）</p>
<p>对于TCP/IP，端点地址使用sockaddr_in结构体。</p>
<p>但是必须结构转换才能用这个函数：<strong>Must cast Internet-specific socket address</strong> (struct sockaddr_in *) to generic socket address (struct sockaddr *) for bind</p>
<p><img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202303141145598.png" alt="image-20230314114500548"></p>
<h4 id="listen"><a href="#listen" class="headerlink" title="listen()"></a>listen()</h4><p>TCP server使用：place a socket in <em>passive mode</em> and make it ready to accept incoming connections</p>
<blockquote>
<p>It only applies to socket used with <strong>TCP</strong></p>
</blockquote>
<p><img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202303141146788.png" alt="image-20230314114620736"></p>
<h4 id="accept"><a href="#accept" class="headerlink" title="accept()"></a>accept()</h4><p>服务器调用accept()来提取下一个传入请求</p>
<p>Accept()为每个新的连接请求创建一个<strong>新的套接字</strong>，并将新套接字的描述符返回给它的调用者</p>
<img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202303141152590.jpg" alt="6b6e6f516f1a636cb062e0bd4f47923" style="zoom:50%;">

<p><img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202303141151250.png" alt="image-20230314115114195"></p>
<p>返回一个通信的stocket 的fd</p>
<h4 id="connect"><a href="#connect" class="headerlink" title="connect()"></a>connect()</h4><p>a <strong>client</strong> calls <em>connect()</em> to establish an active connection to a remote server</p>
<p>Must cast Internet-specific socket address (struct sockaddr_in *) to generic socket address (struct sockaddr *) for connect</p>
<p><img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202303141153625.png" alt="image-20230314115347571"></p>
<h4 id="send"><a href="#send" class="headerlink" title="send()"></a>send()</h4><p>应用程序传递数据应该发送到的套接字的描述符、要发送的数据的地址和数据的长度</p>
<p><img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202303141154573.png" alt="image-20230314115431518"></p>
<h4 id="recv"><a href="#recv" class="headerlink" title="recv()"></a>recv()</h4><p><img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202303141156840.png" alt="image-20230314115606787"></p>
<h4 id="UDP只有两个：sendto-amp-recvfrom"><a href="#UDP只有两个：sendto-amp-recvfrom" class="headerlink" title="UDP只有两个：sendto() &amp; recvfrom()"></a>UDP只有两个：sendto() &amp; recvfrom()</h4><p>前面send() recv()因为已经建立好连接了，所以参数中不用有目标的地址</p>
<p>UDP无连接：</p>
<p>​		sendto() requires the caller to specify a destination</p>
<p>​		recvfrom() uses an argument to specify where to record the sender’s address</p>
<p><img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202303141157577.png" alt="image-20230314115736518"></p>
<h4 id="close-1"><a href="#close-1" class="headerlink" title="close()"></a>close()</h4><p>一旦客户端或服务器完成对套接字的使用，就会调用close来释放它<img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202303141159018.png" alt="image-20230314115904963"></p>
<h4 id="inet-aton-amp-inet-addr"><a href="#inet-aton-amp-inet-addr" class="headerlink" title="inet_aton() &amp; inet_addr()"></a>inet_aton() &amp; inet_addr()</h4><p>第二个地址用来存转换后的</p>
<p>将一个字符串表示的点分十进制IP地址IP转换为网络字节序（这俩一个功能）</p>
<p><img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202303141159814.png" alt="image-20230314115942758"></p>
<p>直接返回</p>
<h4 id="inet-ntoa"><a href="#inet-ntoa" class="headerlink" title="inet_ntoa()"></a>inet_ntoa()</h4><p>将32位整数(网络字节顺序的IP地址)映射为点分十进制格式的ASCII字符串</p>
<p><img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202303141201022.png" alt="image-20230314120153969"></p>
<h2 id="Sample-Programs"><a href="#Sample-Programs" class="headerlink" title="Sample Programs"></a>Sample Programs</h2><h3 id="TCP"><a href="#TCP" class="headerlink" title="TCP"></a>TCP</h3><p><img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202303141204017.png" alt="image-20230314120403961"></p>
<p>TCP的close只能 close掉通信的stocket</p>
<h3 id="UDP"><a href="#UDP" class="headerlink" title="UDP"></a>UDP</h3><p><img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202303141204294.png" alt="image-20230314120445239"></p>
<h4 id="UDP-based-echo-service"><a href="#UDP-based-echo-service" class="headerlink" title="UDP-based echo service"></a>UDP-based echo service</h4><ul>
<li><p>echo服务只是简单地将它接收到的任何数据发送回原始源</p>
</li>
<li><p>一个非常有用的调试和测量工具</p>
</li>
<li><p>基于UDP的Echo Service:定义为基于UDP的数据报应用。服务器监听UDP数据报UDP端口7。当接收到一个数据报时，其中的数据将以应答数据报的形式发回。</p>
</li>
</ul>
<p><img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202303141209677.png" alt="image-20230314120921628"></p>
<h4 id="EchoClient"><a href="#EchoClient" class="headerlink" title="EchoClient"></a>EchoClient</h4><h5 id="头文件："><a href="#头文件：" class="headerlink" title="头文件："></a>头文件：</h5><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span> <span class="token comment">/* for printf() and fprintf() */</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/socket.h&gt;</span> <span class="token comment">/* for socket(), sendto() and 
recvfrom() */</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;arpa/inet.h&gt;</span> <span class="token comment">/* for sockaddr_in and inet_addr() */</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h&gt;</span> <span class="token comment">/* for atoi() and exit() */</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string.h&gt;</span> <span class="token comment">/* for memset() */</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h&gt;</span> <span class="token comment">/* for close() */</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h5 id="Initial-part-of-UDP-EchoClient"><a href="#Initial-part-of-UDP-EchoClient" class="headerlink" title="Initial part of UDP EchoClient"></a>Initial part of UDP EchoClient</h5><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">ECHOMAX</span> <span class="token expression"><span class="token number">255</span> </span><span class="token comment">/* Longest string to echo */</span></span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">//argc参数个数，argv[]具体内容</span>
<span class="token punctuation">{</span>
<span class="token keyword">int</span> sock<span class="token punctuation">;</span> <span class="token comment">/* Socket descriptor */</span>
<span class="token keyword">struct</span> <span class="token class-name">sockaddr_in</span> echoServAddr<span class="token punctuation">;</span> <span class="token comment">/* Echo server address */</span>
<span class="token keyword">struct</span> <span class="token class-name">sockaddr_in</span> fromAddr<span class="token punctuation">;</span> <span class="token comment">/* Source address of echo */</span>
<span class="token keyword">unsigned</span> <span class="token keyword">short</span> echoServPort<span class="token punctuation">;</span> <span class="token comment">/* Echo server port */</span> 
<span class="token keyword">unsigned</span> <span class="token keyword">int</span> fromSize<span class="token punctuation">;</span> <span class="token comment">/* In-out of address size 
for recvfrom() */</span>
<span class="token keyword">char</span> <span class="token operator">*</span>servIP<span class="token punctuation">;</span> <span class="token comment">/* IP address of server */</span>
<span class="token keyword">char</span> <span class="token operator">*</span>echoString<span class="token punctuation">;</span> <span class="token comment">/* String to send to echo server */</span>
<span class="token keyword">char</span> echoBuffer<span class="token punctuation">[</span>ECHOMAX<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">/* Buffer for receiving 
echoed string（最后一个是/0） */</span>
<span class="token keyword">int</span> echoStringLen<span class="token punctuation">;</span> <span class="token comment">/* Length of string to echo （发送的）*/</span>
<span class="token keyword">int</span> respStringLen<span class="token punctuation">;</span> <span class="token comment">/* Length of received response */</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>argc: 整数，传给main()的命令行参数个数</strong></p>
<p> <strong>argv: 字符串数组。argv是一个指针数组，元素个数是argc，存放的是指向每一个参数的指针</strong></p>
<img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202303211002393.png" alt="image-20230321100217339" style="zoom:67%;">

<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>argc <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span>argc <span class="token operator">&gt;</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">/* Test for correct number of
arguments 参数数为3、4才执行*/</span>
<span class="token punctuation">{</span>
<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Usage: %s &lt;Server IP&gt; &lt;Echo Word&gt; [&lt;Echo Port&gt;]\n"</span><span class="token punctuation">,</span> 
argv<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
servIP <span class="token operator">=</span> argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">/* First arg: server IP address (dotted quad) */</span>
echoString <span class="token operator">=</span> argv<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">/* Second arg: string to echo */</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>echoStringLen <span class="token operator">=</span> <span class="token function">strlen</span><span class="token punctuation">(</span>echoString<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> ECHOMAX<span class="token punctuation">)</span> <span class="token comment">/* Check input 
length */</span>
<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Echo word too long.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token keyword">if</span> <span class="token punctuation">(</span>argc <span class="token operator">==</span> <span class="token number">4</span><span class="token punctuation">)</span>
echoServPort <span class="token operator">=</span> <span class="token function">atoi</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/* ASCII to integer Use given port, if any */</span>
<span class="token keyword">else</span><span class="token comment">//如果没自定义端口，就给7；</span>
echoServPort <span class="token operator">=</span> <span class="token number">7</span><span class="token punctuation">;</span> <span class="token comment">/* 7 is the well-known port for echo service */</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h5 id="I-x2F-O-part-of-UDP-EchoClient"><a href="#I-x2F-O-part-of-UDP-EchoClient" class="headerlink" title="I/O part of UDP EchoClient"></a>I/O part of UDP EchoClient</h5><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token comment">/* Create a datagram/UDP socket */</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>sock <span class="token operator">=</span> <span class="token function">socket</span><span class="token punctuation">(</span>PF_INET<span class="token punctuation">,</span> SOCK_DGRAM<span class="token punctuation">,</span> IPPROTO_UDP<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token comment">//成功返回描述符，失败小于0</span>
<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"socket() failed.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/* Construct the server address structure */</span>
<span class="token function">memset</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>echoServAddr<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>echoServAddr<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">/*Zero out structure*/</span>初始化
echoServAddr<span class="token punctuation">.</span>sin_family <span class="token operator">=</span> AF_INET<span class="token punctuation">;</span> <span class="token comment">/* Internet addr family */</span>
echoServAddr<span class="token punctuation">.</span>sin_addr<span class="token punctuation">.</span>s_addr <span class="token operator">=</span> <span class="token function">inet_addr</span><span class="token punctuation">(</span>servIP<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">/*Server IP address*/</span>
echoServAddr<span class="token punctuation">.</span>sin_port <span class="token operator">=</span> <span class="token function">htons</span><span class="token punctuation">(</span>echoServPort<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/* Server port */</span>
<span class="token comment">/* Send the string to the server */</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token function">sendto</span><span class="token punctuation">(</span>sock<span class="token punctuation">,</span> echoString<span class="token punctuation">,</span> echoStringLen<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> 
<span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">sockaddr</span> <span class="token operator">*</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span>echoServAddr<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>echoServAddr<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 
<span class="token operator">!=</span> echoStringLen<span class="token punctuation">)</span>
<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"sendto() sent a different number of bytes than expected.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/* Recv a response */</span>
fromSize <span class="token operator">=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>fromAddr<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>respStringLen <span class="token operator">=</span> <span class="token function">recvfrom</span><span class="token punctuation">(</span>sock<span class="token punctuation">,</span> echoBuffer<span class="token punctuation">,</span> ECHOMAX<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">sockaddr</span> <span class="token operator">*</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span>fromAddr<span class="token punctuation">,</span> <span class="token operator">&amp;</span>fromSize<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> echoStringLen<span class="token punctuation">)</span>
<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"recvfrom() failed\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">if</span> <span class="token punctuation">(</span>echoServAddr<span class="token punctuation">.</span>sin_addr<span class="token punctuation">.</span>s_addr <span class="token operator">!=</span> fromAddr<span class="token punctuation">.</span>sin_addr<span class="token punctuation">.</span>s_addr<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">//判断是不是从echoserver来的</span>
<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Error: received a packet from unknown source.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">/* null-terminate the received data */</span>
echoBuffer<span class="token punctuation">[</span>respStringLen<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token char">'\0'</span><span class="token punctuation">;</span>
<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Received: %s\n"</span><span class="token punctuation">,</span> echoBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">/*Print the echoed message*/</span>
<span class="token function">close</span><span class="token punctuation">(</span>sock<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="EchoServer"><a href="#EchoServer" class="headerlink" title="EchoServer"></a>EchoServer</h4><h5 id="Initial-part-of-UDP-EchoServer"><a href="#Initial-part-of-UDP-EchoServer" class="headerlink" title="Initial part of UDP EchoServer"></a>Initial part of UDP EchoServer</h5><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">ECHOMAX</span> <span class="token expression"><span class="token number">255</span> </span><span class="token comment">/* Longest string to echo */</span></span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token keyword">int</span> sock<span class="token punctuation">;</span> <span class="token comment">/* Socket */</span>
<span class="token keyword">struct</span> <span class="token class-name">sockaddr_in</span> echoServAddr<span class="token punctuation">;</span> <span class="token comment">/* Local address */</span>
<span class="token keyword">struct</span> <span class="token class-name">sockaddr_in</span> echoClntAddr<span class="token punctuation">;</span> <span class="token comment">/* Client address */</span>
<span class="token keyword">unsigned</span> <span class="token keyword">int</span> cliAddrLen<span class="token punctuation">;</span> <span class="token comment">/* Length of client address */</span>
<span class="token keyword">char</span> echoBuffer<span class="token punctuation">[</span>ECHOMAX<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">/* Buffer for echo string */</span>
<span class="token keyword">unsigned</span> <span class="token keyword">short</span> echoServPort<span class="token punctuation">;</span> <span class="token comment">/* Server port */</span>
<span class="token keyword">int</span> recvMsgSize<span class="token punctuation">;</span> <span class="token comment">/* Size of received message */</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h5 id="Argument-check-part-of-UDP-EchoServer"><a href="#Argument-check-part-of-UDP-EchoServer" class="headerlink" title="Argument check part of UDP EchoServer"></a>Argument check part of UDP EchoServer</h5><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">if</span> <span class="token punctuation">(</span>argc <span class="token operator">!=</span> <span class="token number">2</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Usage: %s &lt;UDP SERVER PORT&gt;\n"</span><span class="token punctuation">,</span> argv<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h5 id="Socket-part-of-UDP-EchoServer"><a href="#Socket-part-of-UDP-EchoServer" class="headerlink" title="Socket part of UDP EchoServer"></a>Socket part of UDP EchoServer</h5><pre class="line-numbers language-c" data-language="c"><code class="language-c">echoServPort <span class="token operator">=</span> <span class="token function">atoi</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/* First arg: local port */</span>
<span class="token comment">/* Create socket for sending/receiving datagrams */</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>sock <span class="token operator">=</span> <span class="token function">socket</span><span class="token punctuation">(</span>PF_INET<span class="token punctuation">,</span> SOCK_DGRAM<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"socket() failed.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/* Construct local address structure */</span>
<span class="token function">memset</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>echoServAddr<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>echoServAddr<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
echoServAddr<span class="token punctuation">.</span>sin_family <span class="token operator">=</span> AF_INET<span class="token punctuation">;</span>
echoServAddr<span class="token punctuation">.</span>sin_addr<span class="token punctuation">.</span>s_addr <span class="token operator">=</span> <span class="token function">htonl</span><span class="token punctuation">(</span>INADDR_ANY<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//0.0.0.0</span>
echoServAddr<span class="token punctuation">.</span>sin_port <span class="token operator">=</span><span class="token function">htons</span><span class="token punctuation">(</span>echoServPort<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/* Bind to the local address */</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token function">bind</span><span class="token punctuation">(</span>sock<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">sockaddr</span> <span class="token operator">*</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span>echoServAddr<span class="token punctuation">,</span> <span class="token comment">//强制转换</span>
<span class="token keyword">sizeof</span><span class="token punctuation">(</span>echoServAddr<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"bind() failed.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h5 id="Main-loop-of-UDP-EchoServer"><a href="#Main-loop-of-UDP-EchoServer" class="headerlink" title="Main loop of UDP EchoServer"></a>Main loop of UDP EchoServer</h5><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token punctuation">)</span> <span class="token comment">/* Run forever */</span>
<span class="token punctuation">{</span>
<span class="token comment">/* Set the size of the in-out parameter */</span>
cliAddrLen <span class="token operator">=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>echoClntAddr<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/* Block until receive message from a client */</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>recvMsgSize <span class="token operator">=</span> <span class="token function">recvfrom</span><span class="token punctuation">(</span>sock<span class="token punctuation">,</span> echoBuffer<span class="token punctuation">,</span> ECHOMAX<span class="token punctuation">,</span> 
<span class="token number">0</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">sockaddr</span> <span class="token operator">*</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span>echoClntAddr<span class="token punctuation">,</span> <span class="token operator">&amp;</span>cliAddrLen<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"recvfrom() failed.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Handling client %s\n"</span><span class="token punctuation">,</span><span class="token function">inet_ntoa</span><span class="token punctuation">(</span>echoClntAddr<span class="token punctuation">.</span>sin_addr<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/* Send received datagram back to the client */</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token function">sendto</span><span class="token punctuation">(</span>sock<span class="token punctuation">,</span> echoBuffer<span class="token punctuation">,</span> recvMsgSize<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
	<span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">sockaddr</span> <span class="token operator">*</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span>echoClntAddr<span class="token punctuation">,</span> 
	<span class="token keyword">sizeof</span><span class="token punctuation">(</span>echoClntAddr<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> recvMsgSize<span class="token punctuation">)</span>
	<span class="token function">printf</span><span class="token punctuation">(</span>"<span class="token function">sendto</span><span class="token punctuation">(</span><span class="token punctuation">)</span> sent a different number of bytes 
			than expected<span class="token punctuation">.</span>\n"<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202303211032402.png" alt="image-20230321103225333"></p>
<p><img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202303211032291.png" alt="image-20230321103237237"></p>
<p>$是普通用户权限</p>
<p>#是root权限</p>
<h5 id="使用默认端口"><a href="#使用默认端口" class="headerlink" title="使用默认端口"></a>使用默认端口</h5><p><img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202303211033993.png" alt="image-20230321103346931"></p>
<h5 id="使用自定义端口"><a href="#使用自定义端口" class="headerlink" title="使用自定义端口"></a>使用自定义端口<img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202303211034263.png" alt="image-20230321103439203"></h5></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="https://chilh.top">chilh</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://chilh.top/post/02%20stocker%20programming.html">https://chilh.top/post/02%20stocker%20programming.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://chilh.top" target="_blank">Chilh</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E5%A4%A7%E4%B8%89%E4%B8%8B%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/">大三下课程笔记</a><a class="post-meta__tags" href="/tags/BUPT/">BUPT</a><a class="post-meta__tags" href="/tags/%E4%BA%92%E8%81%94%E7%BD%91%E5%BA%94%E7%94%A8/">互联网应用</a></div><div class="post_share"><div class="social-share" data-image="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202306221734670.jpg" data-sites="twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/post/02.5%20linux.html" title="互联网应用笔记（三）"><img class="cover" src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202306221734670.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">互联网应用笔记（三）</div></div></a></div><div class="next-post pull-right"><a href="/post/01%20Introduction.html" title="互联网应用笔记（一）"><img class="cover" src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202306221734670.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">互联网应用笔记（一）</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/post/01%20Introduction.html" title="互联网应用笔记（一）"><img class="cover" src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202306221734670.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-06-20</div><div class="title">互联网应用笔记（一）</div></div></a></div><div><a href="/post/02.5%20linux.html" title="互联网应用笔记（三）"><img class="cover" src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202306221734670.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-06-20</div><div class="title">互联网应用笔记（三）</div></div></a></div><div><a href="/post/04%20DHCP.html" title="互联网应用笔记（四）"><img class="cover" src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202306221734670.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-06-20</div><div class="title">互联网应用笔记（四）</div></div></a></div><div><a href="/post/05%20Telnet.html" title="互联网应用笔记（五）"><img class="cover" src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202306221734670.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-06-20</div><div class="title">互联网应用笔记（五）</div></div></a></div><div><a href="/post/06%20DNS.html" title="互联网应用笔记（六）"><img class="cover" src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202306221734670.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-06-20</div><div class="title">互联网应用笔记（六）</div></div></a></div><div><a href="/post/07%20FTP.html" title="互联网应用笔记（七）"><img class="cover" src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202306221734670.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-06-20</div><div class="title">互联网应用笔记（七）</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="waline-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/%E5%A4%B4%E5%83%8F.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">chilh</div><div class="author-info__description">记录学习笔记，学艺不精，大家多多评论指教</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">70</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">20</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">7</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="mailto:1547405085@qq.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Network-Socket-Programming"><span class="toc-number">1.</span> <span class="toc-text">Network Socket Programming</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Introduction-to-NP"><span class="toc-number">1.1.</span> <span class="toc-text">Introduction to NP</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AF%BE%E4%B8%8Aenvironments"><span class="toc-number">1.2.</span> <span class="toc-text">课上environments</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#C-Compiler-in-Linux"><span class="toc-number">1.2.1.</span> <span class="toc-text">C Compiler in Linux</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#debugger-in-Linux"><span class="toc-number">1.2.2.</span> <span class="toc-text">debugger in Linux</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Basic-Concepts"><span class="toc-number">1.3.</span> <span class="toc-text">Basic Concepts</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#process"><span class="toc-number">1.3.1.</span> <span class="toc-text">process</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#PID-Process-ID"><span class="toc-number">1.3.1.1.</span> <span class="toc-text">PID (Process ID)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Related-system-calls"><span class="toc-number">1.3.1.2.</span> <span class="toc-text">Related system calls</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#fork"><span class="toc-number">1.3.1.3.</span> <span class="toc-text">fork()</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#fork-%E7%89%B9%E6%80%A7"><span class="toc-number">1.3.1.3.1.</span> <span class="toc-text">fork()特性</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#exec"><span class="toc-number">1.3.1.4.</span> <span class="toc-text">exec()</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#file-descriptor"><span class="toc-number">1.3.2.</span> <span class="toc-text">file descriptor</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#open"><span class="toc-number">1.3.2.1.</span> <span class="toc-text">open</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#close"><span class="toc-number">1.3.2.2.</span> <span class="toc-text">close</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#read"><span class="toc-number">1.3.2.3.</span> <span class="toc-text">read</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#write"><span class="toc-number">1.3.2.4.</span> <span class="toc-text">write</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#lseek-%E6%94%B9%E5%8F%98%E6%96%87%E4%BB%B6%E5%81%8F%E7%A7%BB%E9%87%8F"><span class="toc-number">1.3.2.5.</span> <span class="toc-text">lseek 改变文件偏移量</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#dup"><span class="toc-number">1.3.2.6.</span> <span class="toc-text">dup</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#fcntl"><span class="toc-number">1.3.2.7.</span> <span class="toc-text">fcntl</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#File-Permissions"><span class="toc-number">1.3.2.8.</span> <span class="toc-text">File Permissions</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Sample-program-of-lseek-%E2%80%93-lseek1-c"><span class="toc-number">1.3.2.8.1.</span> <span class="toc-text">Sample program of lseek() – lseek1.c</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Sample-program-of-read-and-write-%E2%80%93-readwrite1-c"><span class="toc-number">1.3.2.8.2.</span> <span class="toc-text">Sample program of read() and write() – readwrite1.c</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#signal"><span class="toc-number">1.3.3.</span> <span class="toc-text">signal</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Client-server-model"><span class="toc-number">1.4.</span> <span class="toc-text">Client-server model</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Servers"><span class="toc-number">1.4.0.1.</span> <span class="toc-text">Servers</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Useful-Unix-Commands"><span class="toc-number">1.4.0.2.</span> <span class="toc-text">Useful Unix Commands</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#netstat"><span class="toc-number">1.4.0.2.1.</span> <span class="toc-text">netstat</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#ifconfig"><span class="toc-number">1.4.0.2.2.</span> <span class="toc-text">- ifconfig</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#ping"><span class="toc-number">1.4.0.2.3.</span> <span class="toc-text">ping</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Structures-about-IP-address-and-DNS"><span class="toc-number">1.5.</span> <span class="toc-text">Structures about  IP address and DNS</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#IP-Addresses"><span class="toc-number">1.5.1.</span> <span class="toc-text">IP Addresses</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Two-ways-to-store-multi-byte-integers"><span class="toc-number">1.5.1.1.</span> <span class="toc-text">Two ways to store multi-byte integers</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Host-byte-order-vs-network-byte-order"><span class="toc-number">1.5.1.2.</span> <span class="toc-text">Host byte order vs. network byte order</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BD%AC%E6%8D%A2%E7%9A%84%E5%87%BD%E6%95%B0"><span class="toc-number">1.5.1.2.1.</span> <span class="toc-text">转换的函数</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Domain-Name-System"><span class="toc-number">1.5.2.</span> <span class="toc-text">Domain Name System</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%B0%83%E7%94%A8%E5%87%BD%E6%95%B0"><span class="toc-number">1.5.2.1.</span> <span class="toc-text">调用函数</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Socket-Interface"><span class="toc-number">1.6.</span> <span class="toc-text">Socket Interface</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#What-is-a-socket"><span class="toc-number">1.6.1.</span> <span class="toc-text">What is a socket?</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Internet-specific-socket-address-bits-x2F-socket-h"><span class="toc-number">1.6.1.1.</span> <span class="toc-text">Internet-specific socket address (bits&#x2F;socket.h)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Generic-socket-address-lt-sys-x2F-socket-h-gt"><span class="toc-number">1.6.1.2.</span> <span class="toc-text">Generic socket address (&lt;sys&#x2F;socket.h&gt;)</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%AF%B9%E6%AF%94"><span class="toc-number">1.6.1.2.1.</span> <span class="toc-text">对比</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Sockets-Interface"><span class="toc-number">1.6.2.</span> <span class="toc-text">Sockets Interface</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Stream-Socket"><span class="toc-number">1.6.2.1.</span> <span class="toc-text">Stream Socket</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Datagram-Socket"><span class="toc-number">1.6.2.2.</span> <span class="toc-text">Datagram Socket</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Raw-Sockets-Service"><span class="toc-number">1.6.2.3.</span> <span class="toc-text">Raw Sockets Service</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Reliably-delivered-Message-Socket"><span class="toc-number">1.6.2.4.</span> <span class="toc-text">Reliably-delivered Message Socket</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Sequenced-Packet-Stream-Socket"><span class="toc-number">1.6.2.5.</span> <span class="toc-text">Sequenced Packet Stream Socket</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Major-System-Calls"><span class="toc-number">1.7.</span> <span class="toc-text">Major System Calls</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Socket-Operation"><span class="toc-number">1.7.1.</span> <span class="toc-text">Socket Operation</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Byte-Order-Conversion"><span class="toc-number">1.7.2.</span> <span class="toc-text">Byte Order Conversion</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Address-Formats-Conversion"><span class="toc-number">1.7.3.</span> <span class="toc-text">Address Formats Conversion</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Socket-Option"><span class="toc-number">1.7.4.</span> <span class="toc-text">Socket Option</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Name-and-Address-OperationA"><span class="toc-number">1.7.5.</span> <span class="toc-text">Name and Address OperationA</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Process-of-Socket-Operation-TCP-Operations"><span class="toc-number">1.7.6.</span> <span class="toc-text">Process of Socket Operation:TCP Operations</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#socket"><span class="toc-number">1.7.6.1.</span> <span class="toc-text">socket()</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#bind"><span class="toc-number">1.7.6.2.</span> <span class="toc-text">bind()</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#listen"><span class="toc-number">1.7.6.3.</span> <span class="toc-text">listen()</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#accept"><span class="toc-number">1.7.6.4.</span> <span class="toc-text">accept()</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#connect"><span class="toc-number">1.7.6.5.</span> <span class="toc-text">connect()</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#send"><span class="toc-number">1.7.6.6.</span> <span class="toc-text">send()</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#recv"><span class="toc-number">1.7.6.7.</span> <span class="toc-text">recv()</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#UDP%E5%8F%AA%E6%9C%89%E4%B8%A4%E4%B8%AA%EF%BC%9Asendto-amp-recvfrom"><span class="toc-number">1.7.6.8.</span> <span class="toc-text">UDP只有两个：sendto() &amp; recvfrom()</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#close-1"><span class="toc-number">1.7.6.9.</span> <span class="toc-text">close()</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#inet-aton-amp-inet-addr"><span class="toc-number">1.7.6.10.</span> <span class="toc-text">inet_aton() &amp; inet_addr()</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#inet-ntoa"><span class="toc-number">1.7.6.11.</span> <span class="toc-text">inet_ntoa()</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Sample-Programs"><span class="toc-number">1.8.</span> <span class="toc-text">Sample Programs</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#TCP"><span class="toc-number">1.8.1.</span> <span class="toc-text">TCP</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#UDP"><span class="toc-number">1.8.2.</span> <span class="toc-text">UDP</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#UDP-based-echo-service"><span class="toc-number">1.8.2.1.</span> <span class="toc-text">UDP-based echo service</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#EchoClient"><span class="toc-number">1.8.2.2.</span> <span class="toc-text">EchoClient</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%A4%B4%E6%96%87%E4%BB%B6%EF%BC%9A"><span class="toc-number">1.8.2.2.1.</span> <span class="toc-text">头文件：</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Initial-part-of-UDP-EchoClient"><span class="toc-number">1.8.2.2.2.</span> <span class="toc-text">Initial part of UDP EchoClient</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#I-x2F-O-part-of-UDP-EchoClient"><span class="toc-number">1.8.2.2.3.</span> <span class="toc-text">I&#x2F;O part of UDP EchoClient</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#EchoServer"><span class="toc-number">1.8.2.3.</span> <span class="toc-text">EchoServer</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Initial-part-of-UDP-EchoServer"><span class="toc-number">1.8.2.3.1.</span> <span class="toc-text">Initial part of UDP EchoServer</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Argument-check-part-of-UDP-EchoServer"><span class="toc-number">1.8.2.3.2.</span> <span class="toc-text">Argument check part of UDP EchoServer</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Socket-part-of-UDP-EchoServer"><span class="toc-number">1.8.2.3.3.</span> <span class="toc-text">Socket part of UDP EchoServer</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Main-loop-of-UDP-EchoServer"><span class="toc-number">1.8.2.3.4.</span> <span class="toc-text">Main loop of UDP EchoServer</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E9%BB%98%E8%AE%A4%E7%AB%AF%E5%8F%A3"><span class="toc-number">1.8.2.3.5.</span> <span class="toc-text">使用默认端口</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E8%87%AA%E5%AE%9A%E4%B9%89%E7%AB%AF%E5%8F%A3"><span class="toc-number">1.8.2.3.6.</span> <span class="toc-text">使用自定义端口</span></a></li></ol></li></ol></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/post/%E7%BC%93%E5%AD%98%E6%9B%BF%E6%8D%A2%E7%AE%97%E6%B3%951-%E7%B2%97%E9%A2%97%E7%B2%92%E7%AD%96%E7%95%A5.html" title="缓存替换算法"><img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202505112103982.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="缓存替换算法"/></a><div class="content"><a class="title" href="/post/%E7%BC%93%E5%AD%98%E6%9B%BF%E6%8D%A2%E7%AE%97%E6%B3%951-%E7%B2%97%E9%A2%97%E7%B2%92%E7%AD%96%E7%95%A5.html" title="缓存替换算法">缓存替换算法</a><time datetime="2025-01-21T06:33:23.000Z" title="发表于 2025-01-21 14:33:23">2025-01-21</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/post/%E7%BC%93%E5%AD%98%E6%9B%BF%E6%8D%A2%E7%AE%97%E6%B3%950.html" title="Cache Replacement Policies - introduction"><img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202306221734670.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Cache Replacement Policies - introduction"/></a><div class="content"><a class="title" href="/post/%E7%BC%93%E5%AD%98%E6%9B%BF%E6%8D%A2%E7%AE%97%E6%B3%950.html" title="Cache Replacement Policies - introduction">Cache Replacement Policies - introduction</a><time datetime="2025-01-20T11:24:52.000Z" title="发表于 2025-01-20 19:24:52">2025-01-20</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/post/%E7%BC%93%E5%AD%98%E6%9B%BF%E6%8D%A2%E7%AE%97%E6%B3%952-%E7%BB%86%E9%A2%97%E7%B2%92%E7%AD%96%E7%95%A5.html" title="缓存替换算法"><img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202505112103982.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="缓存替换算法"/></a><div class="content"><a class="title" href="/post/%E7%BC%93%E5%AD%98%E6%9B%BF%E6%8D%A2%E7%AE%97%E6%B3%952-%E7%BB%86%E9%A2%97%E7%B2%92%E7%AD%96%E7%95%A5.html" title="缓存替换算法">缓存替换算法</a><time datetime="2025-01-20T11:24:52.000Z" title="发表于 2025-01-20 19:24:52">2025-01-20</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/post/2024-lastday.html" title="2024-总结"><img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202501010045372.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="2024-总结"/></a><div class="content"><a class="title" href="/post/2024-lastday.html" title="2024-总结">2024-总结</a><time datetime="2024-12-31T14:59:00.000Z" title="发表于 2024-12-31 22:59:00">2024-12-31</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/post/riscv%20v%E6%89%A9%E5%B1%95%E7%BF%BB%E8%AF%91%E6%80%BB%E7%BB%93.html" title="v扩展翻译总结”"><img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202411102035591.jfif" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="v扩展翻译总结”"/></a><div class="content"><a class="title" href="/post/riscv%20v%E6%89%A9%E5%B1%95%E7%BF%BB%E8%AF%91%E6%80%BB%E7%BB%93.html" title="v扩展翻译总结”">v扩展翻译总结”</a><time datetime="2024-11-10T12:30:33.000Z" title="发表于 2024-11-10 20:30:33">2024-11-10</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202306221734670.jpg')"><div id="footer-wrap"><div class="copyright">&copy;2021 - 2025 By chilh</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>function loadWaline () {
  function insertCSS () {
    const link = document.createElement("link")
    link.rel = "stylesheet"
    link.href = "https://cdn.jsdelivr.net/npm/@waline/client/dist/waline.min.css"
    document.head.appendChild(link)
  }

  function initWaline () {
    const waline = Waline.init(Object.assign({
      el: '#waline-wrap',
      serverURL: 'https://chilh-comment-nwkfkyqk8-zhanzghouhe.vercel.app',
      pageview: false,
      dark: 'html[data-theme="dark"]',
      path: window.location.pathname,
      comment: false,
    }, null))
  }

  if (typeof Waline === 'function') initWaline()
  else {
    insertCSS()
    getScript('https://cdn.jsdelivr.net/npm/@waline/client/dist/waline.min.js').then(initWaline)
  }
}

if ('Waline' === 'Waline' || !true) {
  if (true) btf.loadComment(document.getElementById('waline-wrap'),loadWaline)
  else setTimeout(loadWaline, 0)
} else {
  function loadOtherComment () {
    loadWaline()
  }
}</script></div><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-nest.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"model":{"jsonPath":"/live2dw/assets/wanko.model.json"},"display":{"position":"right","width":85,"height":400,"hOffset":-18,"vOffset":25},"mobile":{"show":true},"react":{"opacity":0.7},"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body></html>