<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>DFT-S-OFDM | Chilh</title><meta name="author" content="chilh"><meta name="copyright" content="chilh"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="DFT-S-OFDM设计">
<meta property="og:type" content="article">
<meta property="og:title" content="DFT-S-OFDM">
<meta property="og:url" content="https://chilh.top/post/DFT-S-OFDM.html">
<meta property="og:site_name" content="Chilh">
<meta property="og:description" content="DFT-S-OFDM设计">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202307211649897.jpg">
<meta property="article:published_time" content="2023-07-21T08:45:03.000Z">
<meta property="article:modified_time" content="2023-07-21T08:53:15.315Z">
<meta property="article:author" content="chilh">
<meta property="article:tag" content="4G">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202307211649897.jpg"><link rel="shortcut icon" href="/"><link rel="canonical" href="https://chilh.top/post/DFT-S-OFDM.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"prismjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: true,
    post: true
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":50,"languages":{"author":"作者: chilh","link":"链接: ","source":"来源: Chilh","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#1f1f1f","position":"bottom-left"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  }
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'DFT-S-OFDM',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-07-21 16:53:15'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><script charset="UTF-8" id="LA_COLLECT" src="//sdk.51.la/js-sdk-pro.min.js"></script><script>LA.init({id:"Jz34H84gllFAWP2o",ck:"Jz34H84gllFAWP2o"})</script><script src="https://sdk.51.la/perf/js-sdk-perf.min.js" crossorigin="anonymous"></script><script> new LingQue.Monitor().init({id:"Jz365mPYN13QqIwT"});</script><script src="https://npm.elemecdn.com/echarts@4.9.0/dist/echarts.min.js"></script><script src="https://npm.elemecdn.com/echarts@4.9.0/map/js/china.js"></script><script src="https://npm.elemecdn.com/echarts@4.9.0/dist/echarts.min.js"></script><meta name="generator" content="Hexo 6.1.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
</head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><script>const preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',()=> { preloader.endLoading() })

if (false) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/%E5%A4%B4%E5%83%8F.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">70</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">20</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">7</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/gallery/"><i class="fa-fw fas fa-camera-retro"></i><span> 图库</span></a></div><div class="menus_item"><a class="site-page" href="/charts/"><i class="fa-fw fa fa-heartbeat"></i><span> 统计</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202307211649897.jpg')"><nav id="nav"><span id="blog-info"><a href="/" title="Chilh"><span class="site-name">Chilh</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/gallery/"><i class="fa-fw fas fa-camera-retro"></i><span> 图库</span></a></div><div class="menus_item"><a class="site-page" href="/charts/"><i class="fa-fw fa fa-heartbeat"></i><span> 统计</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">DFT-S-OFDM</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-07-21T08:45:03.000Z" title="发表于 2023-07-21 16:45:03">2023-07-21</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-07-21T08:53:15.315Z" title="更新于 2023-07-21 16:53:15">2023-07-21</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E9%80%9A%E4%BF%A1/">通信</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">6.8k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>25分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="DFT-S-OFDM"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1>DFT-S-OFDM</h1>
<p>记录一个小项目学习过程</p>
<p>传统OFDM功率均峰比较大，采用DFT-S-OFDM降低均峰比</p>
<h2 id="预备知识">预备知识</h2>
<h3 id="多址和复用（FDM）">多址和复用（FDM）</h3>
<p><img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202307211651786.png" alt="image-20230721143417632"></p>
<h3 id="直接扩频"><strong>直接扩频</strong></h3>
<p>使用扩频码和原始信号相乘以此得到更高频率的信号</p>
<p><img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202307211651725.png" alt="image-20230713191953158"></p>
<h2 id="原理">原理</h2>
<p>DFT-S-OFDM是在OFDM内增加DFT扩频操作，以此减小PARR</p>
<h3 id="OFDM的调制框图">OFDM的调制框图</h3>
<p><img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202307211651797.png" alt="image-20230713192055056"></p>
<p>在串并转换后添加DFT扩频以此实现DFT-S-OFDM</p>
<p><img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202307211651754.png" alt="image-20230713184359625"></p>
<p><strong>有意思的是如果DFT扩频序列的长度与IFFT相同，二者作用可以抵消，此时等价于使用SC-FDE.</strong></p>
<p>DFT-S-OFDM之所以被称为单载波OFDM是与它前面对数据块做DFT变换的点数M和进行OFDM调制的IFFT点数N有关，一般N＞M;当N=M时，信号直接调制到子载波上，FFT和IFFT作用互相抵消，信号就直接在时域上进行传输;当N＞M时，经过DFT变换，在IFFT处理之前，每个子载波上的数据己不再是独立的源数据，而是各个源数据的叠加，相当于每个源数据扩展到了多个子载波上构成单载波，信号映射到子载波上进行OFDM调制，其中N个子载波上有输入数据。</p>
<p>在时域看来，输入数据的符号持续时间T在经过SC-FDMA调制后变为:T=(N/M)*T</p>
<p><img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202307211651713.png" alt="image-20230713204051007"></p>
<h3 id="DFT扩频">DFT扩频</h3>
<blockquote>
<p>参数：M是DFT输出个数，N是IFFT输入个数，S=N/M是带宽扩频因子</p>
</blockquote>
<p>分布式FDMA和集中式FDMA</p>
<p>分布式FDMA是指：均匀把DFT结果分派到子载波上，并且其余N-M位为0</p>
<p>集中式FDMA是指：只在中间相邻位置将DFT插入。</p>
<p><img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202307211651734.png" alt="image-20230713193811767"></p>
<p>本项目采用另一种FDMA方式：</p>
<h4 id="扩频数学表示">扩频数学表示</h4>
<p><img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202307211651410.png" alt="image-20230713195016314"></p>
<p>$\widetilde{X}[k]$ 是IFFT的输入，将其做n点的IFFT</p>
<img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202307131956195.png" alt="image-20230713195645147" style="zoom:67%;">
<p>有<img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202307131957338.png" alt="image-20230713195709311" style="zoom:67%;">的相位偏移</p>
<h2 id="设计流程">设计流程</h2>
<h3 id="处理流程">处理流程</h3>
<p>整个接收端大体上可以分为3个部分，分别是定时同步与帧同步、频偏估计与补偿、信道估计和均衡与解调。</p>
<p>对每一帧信号，接收机都先从空闲状态开始捕获帧头，即在2倍过采样上对长度为16的完美序列进行并行相关，寻找相关峰值。在捕获到帧头后，在8倍过采样上挑选最佳样值供后级模块使用，然后进入帧同步状态，检测前导序列中的序列翻转位置，结合最佳样值和序列翻转位置即可获得准确的同步位置。</p>
<p>此后，接收机开始进行频率估计，获得频偏估计结果并对后续的接收信号进行补偿。在每个子帧导频的CP段（循环前缀），都再当前最佳采样附近重新进行最佳样值选择，并在选择结果的控制下将做完频偏补偿之后的数据经过FIFO缓存送入去CP、FFT变换模块，再将导频部分、数据部分分别送入信道估计和频域均衡与解调模块。</p>
<p>信道估计模块接收256个符号长度的导频部分的FFT变换结果，在频域上对梳状导频点上进行信道估计，并使用线性插值方法得到频域各个点上的信道估计值，利用导频点以外的其他点的频域值进行噪声方差的计算，将512个符号长度的信道系数估计值和噪声方差估计值送入频域均衡与解调模块。</p>
<p>频域均衡模块对子帧中的6个数据块进行均衡。每个数据块首先做FFT转换到频域，利用对应点上的信道估计结果在频域进行信道补偿，然后再做IFFT转换到时域，并分别取I、Q路的符号位完成解调。</p>
<h3 id="帧结构">帧结构</h3>
<p><img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202307211651320.png" alt="未命名文件 (1)"></p>
<p>采用基于块的传输方式，每个数据块前面需要加上循环前缀，循环前缀的时间长度需要大于多径时延</p>
<p>为了实现相干解调，数据帧中需要插入导频，为了获得良好的信道估计性能，我们采用256长度的导频，由于一个帧内分为50个子帧</p>
<p>因此，每个子帧包含1个长度为247符号的跳频切换块，由1个长度为（25+256）导频块以及6个长度为（512+25）的数据块组成</p>
<p>前导序列占用4096个符号</p>
<h3 id="位同步方案"><em><strong>*位同步方案*</strong></em></h3>
<p>在无线通信系统的实际工作过程中，接收端在开机后并不知道接收到的信号从何时起为有用信号，也不知道接收数据的位置，因此要进行接收机后续模块正常的信号处理流程，就需要通过位/帧同步来确定每帧数据的起始位置，从而提取对应位置的数据块。</p>
<p>相关检测是一种定时同步方法，它是根据序列良好的自相关特性来进行同步，相关检测算法是将本地存储的序列与接收信号做相关运算，寻找相关峰出现的位置，获得粗略的位同步。</p>
<p>并行相关是相关检测算法的一种，并行相关是用多个相关器并行进行相关运算，同时对训练序列的不同相位进行相关积分运算。并行相关将所有可能的序列相位同时相关运算，从时间上来讲性能非常高，适合于突发帧传输系统。但是，当训练序列周期如果很长，并行相关实现复杂度就会很高。</p>
<p>本系统选择长度为16的完美序列重复发送构成前导序列用来完成接收端的同步，相关检测算法选择并行相关，并行相关器个数为16，同时对2倍采样的信号进行相关操作。该完美序列为s1= [1+j, 1+j, 1+j, 1+j, 1+j, -1+j, -1-j, 1-j, 1+j, -1-j, 1+j, -1-j, 1+j, 1-j, -1-j, -1+j]。该完美序列的周期自相关</p>
<p>该完美序列的周期自相关特性如下所示，除了相位完全对正的情况出现明显之外，其他位置的相关值均为0。</p>
<p><img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202307211651839.png" alt="img"></p>
<p>图 26完美序列的周期自相关特性</p>
<p>系统接收端收到的是八倍过采样数据，位同步模块先任意选择其中间隔为4的两路数据(比如0，4路)分别送入两个匹配滤波器，每输入一个样值都可以得到一个滤波输出，对滤波输出的I路和Q路的绝对值相加，称为相关值，记忆连续15个相关值并求和，当一个新的相关值与前14个相关值的比值大于门限值时，则认为捕获到信号，也就确定了完美序列的相位。</p>
<p><img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202307211651770.png" alt="img"></p>
<p>接着，进入最佳样值选择和同步验证阶段。同步验证的目的是为了避免冲激噪声使前一步骤同步捕获过门限，发生虚警。验证方法是对连续的4个周期继续进行匹配滤波，在前一阶段过门限的位置求出当前相关值和之前14个相关值之和的比值，如果4次所求得的比值都能超过门限，则认为同步成果，否则，则重新进入捕获状态。</p>
<p>最佳样值选择是在前一步过门限的样值位置基础上，对连续8个样值位置上的相关值进行比较，从中找出大值出现的位置，即为8倍过采样中的最佳样值。</p>
<p><img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202307211651723.png" alt="img"></p>
<p>图 28确定最佳样值流程</p>
<h3 id="帧同步方案"><em><strong>帧同步方案</strong></em></h3>
<p>位同步只是在符号和样点上同步上了，但帧的起始位置还存在模糊问题，为了接收端后续模块的工作，需要进行帧同步。</p>
<p>前16个完美序列周期和后240个完美序列周期相位相反，我们利用前导序列的这一特点来实现帧同步。</p>
<p>帧同步的原理是假设信道变化较慢，相邻的两个完美序列周期所经历的信道不变，那么我们可以对相邻两个完美序列周期的相关值进行共轭相乘，如果相乘的结果为负数，则可以认为这两个周期的序列之间相位发生了突变，</p>
<p>前一个完美序列周期的相关结果：</p>
<p><img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202307211651632.jpeg" alt="img"></p>
<p>如果无跳变，后一个完美序列周期的相关结果为：</p>
<p><img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202307211651823.jpeg" alt="img"></p>
<p>如果有跳变，后一个完美序列周期的相关结果为：</p>
<p><img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202307211651938.jpeg" alt="img"></p>
<p>对<img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202307211651075.jpeg" alt="img">和<img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202307211651445.jpeg" alt="img">做共轭乘，可以得到：</p>
<p><img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202307211651490.jpeg" alt="img"></p>
<p>N表示包含噪声的各项之和。</p>
<p>这样，我们通过确定出当前的完美序列在前导序列中的位置，也由此确定了各个数据样点在帧结构中的位置，完成帧同步。</p>
<p><img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202307211651532.png" alt="img"></p>
<p>图 29帧同步原理示意图</p>
<h4 id="频偏估计方案">频偏估计方案</h4>
<p>由于通信信号受到多普勒效应、接收端和发送端晶振频率不匹配等因素的影响，接收信号的载波频率偏离了接收端的本地振荡频率，导致接收信号在本地振荡频率完成下变频后，通常还存在残留的频率偏差。如果不能消除偏差，接收机的解调性能将受到该偏差的严重影响，最终导致系统的可靠性降低。因此完成频偏估计和补偿是必要的。</p>
<p>本项目中前导序列中的频偏估计方案如下：</p>
<p><img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202307211651710.png" alt="img"></p>
<p>图 210用于频偏估计的长度为3840个符号的前导序列</p>
<p>对于本项目来说，帧同步过后剩余3840个符号，其中符号由完美序列组成，完美序列每16个符号为一组，所以共有<img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202307211651562.png" alt="img">段，每一段都可以计算一个相关值，然后将240个相关值补零后做4096点FFT，其频率分辨率为<img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202307211651714.png" alt="img">。</p>
<p>具体的求频偏估计值算法如下：</p>
<p>位同步和帧同步均已经完成，这里采用基于FFT进行最大似然频偏估计。对于接收到的前导序列，与本地存储的序列进行相关计算，得到240个相关值，在这些相关值后面补3856个零，然后做4096点FFT，对FFT得到的4096个数据取模值，并搜索其最大值位置，则可根据最大值出现的位置计算频偏的粗估计值，然后再基于二次函数拟合的方法进一步估计更精细的频偏。采用的算法如下：</p>
<p>将频率偏移值表示为<img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202307211651953.png" alt="img">，其中<img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202307211651152.png" alt="img">表示FFT幅值最大处对应的频率索引值，<img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202307211651061.png" alt="img">表示真实信号频率与FFT幅值最大点对应索引的偏差，<img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202307211651138.png" alt="img">，<img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202307211651242.png" alt="img">是FFT离散频率间隔（即频率分辨率<img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202307211651432.png" alt="img">）。</p>
<p>基于FFT插值的频移估计方法主要分为粗估计和细估计两个步骤。粗估计就是搜索FFT结果幅值最大点，得到其索引值<img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202307211651605.png" alt="img">。细估计就是利用插值的方法得到真实频率偏移值与<img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202307211651667.png" alt="img">对应频率之间的偏差，即估计<img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202307211651658.png" alt="img">。插值的方法有很多，其中采用最多的就是二次插值方法。二次插值方法描述如下：</p>
<p>近似认为信号频域幅度值是一个二次函数，目的是找出这个函数的最大值，而三个点可以确定一个二次函数。先找到相关值FFT结果幅度最大点，再加上其左右各一个点，就可以进行二次插值了。公式推导如下：</p>
<p>假设FFT幅度最大点的坐标为<img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202307211651830.png" alt="img">，左右两点分别为<img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202307211651770.png" alt="img">，<img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202307211651951.png" alt="img">，其中横坐标表示对应频率值，纵坐标表示FFT结果的幅值。那么根据三点构造二次函数表达式为：</p>
<p><img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202307211651277.png" alt="img"></p>
<p>求得：</p>
<p><img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202307211651401.png" alt="img"></p>
<p>峰值频点横坐标为：  <img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202307211651262.png" alt="img"></p>
<p>其中<img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202307211651404.png" alt="img">，最终<img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202307211651439.png" alt="img">就是估计出来的频率偏移值。</p>
<p><img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202307211651547.png" alt="img"></p>
<p>图 211频偏估计框图</p>
<p>对于跳频抗干扰算法方案中，由于是同源晶振控制生成的，所以不同频率下的频偏是成比例的。设跳频的频率从<img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202307211651962.png" alt="img">，在<img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202307211651038.png" alt="img">频点下的频偏为<img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202307211651138.png" alt="img">，则在<img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202307211651061.png" alt="img">频点下的频偏为<img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202307211651149.png" alt="img">，则不同频点下的频偏的一般公式为<img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202307211651079.png" alt="img"><img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202307211651573.png" alt="img">。</p>
<h4 id="频偏补偿方案">频偏补偿方案</h4>
<p>由上述分析我们可知，计算出频偏估计值后需要对各个子帧的数据进行频偏补偿，这就需要控制直接数字式频率合成器（DDS）在频偏估计后实现频偏补偿。想要补偿频偏，需要在信号上乘<img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202307211651562.png" alt="img">，而<img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202307211651739.png" alt="img">，正余弦相应的频率可以由DDS产生。</p>
<p>在FPGA中DDS核的系统时钟为<img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202307211651632.png" alt="img">，输出频率为<img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202307211651712.png" alt="img">，则输出频率为</p>
<p><img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202307211651799.png" alt="img"></p>
<p>其中，<img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202307211651443.png" alt="img">为相位累加器位数，<img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202307211651384.png" alt="img">为频率控制字</p>
<p>频率分辨率，即频率变化的间隔</p>
<p><img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202307211651452.png" alt="img"></p>
<p>频率控制字即相位增量，其公式为</p>
<p><img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202307211651505.png" alt="img"></p>
<p>其中，<img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202307211651425.png" alt="img">为相位增量，即频率控制字，<img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202307211651533.png" alt="img">为想要输出的频率，<img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202307211616639.png" alt="img">为输入IP的时钟，也是信号的采样时钟，<img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202307211616661.png" alt="img">为频率精度的位数，其计算公式如下，取位都为进位。以产生时钟<img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202307211616751.png" alt="img">为100MHz，频率精度<img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202307211616782.png" alt="img">为1Hz计算</p>
<p><img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202307211616872.png" alt="img"></p>
<p>由DDS产生相应相位的sin和cos，与原始数据进行复数乘法即可完成频偏补偿。</p>
<p><img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202307211616944.png" alt="img"></p>
<p>图 212频偏补偿示意图</p>
<p>对不同的跳频频率点，按上节所述方法计算得到的相应的频偏值。</p>
<h4 id="估计与噪声方差估计方案">估计与噪声方差估计方案</h4>
<p>信道估计整体流程如图所示。前一阶段的模块将接收信号中的导频部分提取出来并送入去CP、FFT变换模块，信道估计模块接收256个符号长度的导频部分的FFT变换结果，将导频处的点依次送入导频处信道估计计算模块，将其他点的值送入噪声方差计算模块。前者与存储在RAM里的原始导频序列的频域变换值进行运算，得到导频点处的信道估计值，再利用线性插值算法得到每个数据符号的信道估计值，送入频域均衡与解调模块；后者进行噪声方差的计算，将噪声方差估计值传入后级模块。</p>
<p><img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202307211616996.png" alt="img"></p>
<p>导频由64位Zadoff-Chu序列重复4次得到。Zadoff-Chu序列的数学描述如下式所示：</p>
<p><img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202307211620231.jpg" alt="img"></p>
<p>公式中，N表示的是序列的长度，q可以为任意整数，u表示原始序列组数，是与N互质的正整数。q和u取值不同，将得到不同的ZC序列。</p>
<p>Zadoff-Chu序列本身具有良好的自相关性、互相关性、对称性和横幅特性。其中，良好的自相关性意味着对于任意ZC序列与其循环移位m（m≠0）位后的序列互不相关；对称性可以降低生成序列的复杂度；恒幅特性有利于接收端实现信道估计。任意Zadoff-Chu序列经过FFT/IFFT变换后的序列仍为Zadoff-Chu序列，具有Zadoff-Chu序列的所有性质。</p>
<p>选取u=9，q=1，N=64的Zadoff-Chu序列，将其重复4次即得256个符号的导频序列，对该序列进行FFT变换，并对变换结果进行映射。将1映射到1023，将序列进行定点量化为I、Q各11比特数，得到的coe文件。</p>
<p>针对该导频结构，导频点上的信道估计结果很容易得到。将接收的导频点处的FFT变换结果Y与上述文件中的原始ZC序列的频域映射值X相除，即这些点上的频域信道估计值为：</p>
<p><img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202307211620234.jpg" alt="img"></p>
<p>为了提高信道估计系数的精度，利用线性插值算法得到频域上512个点的信道估计值。线性插值是根据信号中两个相邻导频点处的信道相响应之间的线性关系来估计这段数据点上的信道系数的插值方法。线性插值只使用两个相邻的导频点对这段数据进行信道估计，具有易于实现、计算快速的优点。线性插值实现过程如下：</p>
<p>两个相邻导频估计值记作<img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202307211620233.jpg" alt="img">、<img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202307211620235.jpg" alt="img">，设数据点<img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202307211620235.jpg" alt="img">位于区间<img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202307211620241.jpg" alt="img">，则该点的信道估计可表示为：</p>
<p><img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202307211620544.jpg" alt="img"></p>
<p>由于除了64个点以外的其他频率点都没有发送信号，接收信号转换到频域在这些点所得到的都是噪声，可以利用这些点的值估算出噪声方差。</p>
<p><img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202307211620570.jpg" alt="img"></p>
<h4 id="频域均衡方案">频域均衡方案</h4>
<p>均衡模块根据信道估计的结果执行相应的算法对信号进行补偿。FFT之后我们得到了各个符号的频域样点，信道估计模块我们得到了每个频域点上对应的信道系数，利用这些数据进行频域均衡，最后将均衡后的信号转为时域信号，硬判决直接对符号的正负进行判决得到最后的结果，处理流程图如图：</p>
<p><img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202307211616025.png" alt="img"></p>
<p>图 214频域均衡流程</p>
<p>最小均方误差算法中构造损失函数：</p>
<p><img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202307211616098.png" alt="img"></p>
<p>假设，x和z是服从均值为0，方差分别为<img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202307211616117.png" alt="img">，<img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202307211651532.png" alt="img">的高斯分布，则MMSE估计为：</p>
<p><img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202307211616364.png" alt="img"></p>
<p>时域上接收信号为发送信号与系统响应的线性卷积，为：</p>
<p><img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202307211616431.png" alt="img"></p>
<p>在单载波频域均衡中，由N位符号组成一个数据块，并添加循环前缀，循环前缀的长度大于信道的最大多径时延，以此保证相邻数据块之间没有干扰。在通常情况下，信道在时间上是慢变的，假设连续的两个数据块的传输过程中，信道冲激响应保持不变。由于循环前缀的存在，信道冲激响应矩阵是循环平移矩阵，即：<img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202307211616447.png" alt="img">，其中<img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202307211616611.png" alt="img">为循环平移矩阵。</p>
<p>对接收到的时域信号做FFT变换，得到频域信号。根据信道冲激响应矩阵的循环平移特性，信道频域响应矩阵是对角矩阵。</p>
<p>两边同时做FFT：</p>
<p><img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202307211616690.png" alt="img"></p>
<p>其中，<img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202307211616758.png" alt="img">，<img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202307211616781.png" alt="img">是对角矩阵，其中<img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202307211616924.png" alt="img">的对角线元素为：</p>
<p><img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202307211616975.png" alt="img"></p>
<p>MMSE均衡矢量形式为：</p>
<p><img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202307211616997.png" alt="img"></p>
<p>分量形式为：</p>
<p><img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202307211616042.png" alt="img"></p>
<p>频域MMSE均衡之后的结果再通过IFFT转换到时域，得到时域符号。</p>
<p><img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202307211616081.png" alt="img"></p>
<p>将经过均衡后的时域结果，送到硬判决模块，直接对符号I、Q路数据的正负进行判决，得到解调结果。</p>
<h2 id="matlab代码">matlab代码</h2>
<pre class="line-numbers language-matlab" data-language="matlab"><code class="language-matlab">clear
clc
CP<span class="token operator">=</span><span class="token number">25</span><span class="token punctuation">;</span><span class="token comment">%CP长度</span>
num_block <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">;</span><span class="token comment">%每个子帧中的FDE块数</span>
num_sf <span class="token operator">=</span> <span class="token number">48</span><span class="token punctuation">;</span> <span class="token comment">%一帧中的子帧数</span>
rate <span class="token operator">=</span> <span class="token number">7.5e6</span><span class="token punctuation">;</span><span class="token comment">%符号速率</span>

S <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>   <span class="token comment">% 扩频因子</span>

block<span class="token operator">=</span><span class="token number">384</span><span class="token punctuation">;</span><span class="token comment">%FDE块大小</span>
block_dft<span class="token operator">=</span><span class="token number">512</span><span class="token punctuation">;</span>
bpc<span class="token operator">=</span><span class="token number">537</span><span class="token punctuation">;</span> <span class="token comment">%块+CP</span>

tr_sym <span class="token operator">=</span> <span class="token function">zeros</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4096</span><span class="token operator">+</span>bpc<span class="token operator">*</span><span class="token punctuation">(</span>num_block<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span>S<span class="token operator">*</span>num_sf<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">%一帧中的所有符号，不含GP</span>
err_rate1<span class="token operator">=</span><span class="token function">zeros</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
s<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
s1<span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">+</span><span class="token number">1j</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token operator">+</span><span class="token number">1j</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token operator">+</span><span class="token number">1j</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token operator">+</span><span class="token number">1j</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token operator">+</span><span class="token number">1j</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token operator">+</span><span class="token number">1j</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token operator">-</span><span class="token number">1j</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token operator">-</span><span class="token number">1j</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token operator">+</span><span class="token number">1j</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token operator">-</span><span class="token number">1j</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token operator">+</span><span class="token number">1j</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token operator">-</span><span class="token number">1j</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token operator">+</span><span class="token number">1j</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token operator">-</span><span class="token number">1j</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token operator">-</span><span class="token number">1j</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token operator">+</span><span class="token number">1j</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
 <span class="token keyword">for</span> <span class="token number">i</span><span class="token operator">=</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">16</span>
     s<span class="token operator">=</span><span class="token punctuation">[</span>s s1<span class="token punctuation">]</span><span class="token punctuation">;</span>
 <span class="token keyword">end</span><span class="token comment">%前16个完美序列，正相位</span>
 <span class="token keyword">for</span> <span class="token number">i</span><span class="token operator">=</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">240</span>
     s<span class="token operator">=</span><span class="token punctuation">[</span>s <span class="token operator">-</span>s1<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">%S1重复16次</span>
     
 <span class="token keyword">end</span> <span class="token comment">%后240个完美序列，反相位</span>
 <span class="token function">tr_sym</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">4096</span><span class="token punctuation">)</span><span class="token operator">=</span>s<span class="token operator">/</span><span class="token function">sqrt</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">%前导，功率归一化</span>
 
 
 <span class="token comment">%以上为生成前导</span>
 
 s2<span class="token operator">=</span><span class="token function">gen_seq</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
p<span class="token operator">=</span><span class="token function">zeros</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>block_dft<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">for</span> <span class="token number">i</span><span class="token operator">=</span><span class="token number">1</span><span class="token operator">:</span>block_dft<span class="token operator">/</span><span class="token number">64</span>
    <span class="token function">p</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">i</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">64</span><span class="token operator">+</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">i</span><span class="token operator">*</span><span class="token number">64</span><span class="token punctuation">)</span> <span class="token operator">=</span> s2<span class="token punctuation">;</span>
<span class="token keyword">end</span>
xx <span class="token operator">=</span> <span class="token function">fft</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span>
xx <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token function">xx</span><span class="token punctuation">(</span><span class="token number">509</span><span class="token operator">:</span><span class="token number">512</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">xx</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">508</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">%错开本振</span>
p<span class="token operator">=</span><span class="token function">ifft</span><span class="token punctuation">(</span>xx<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">%导频生成</span>
b <span class="token operator">=</span> <span class="token function">rcosdesign</span><span class="token punctuation">(</span><span class="token number">0.22</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token string">'sqrt'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">%RRC（根升余弦）冲激响应为b</span>
f_pilot <span class="token operator">=</span> <span class="token function">fft</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token operator">/</span><span class="token function">sqrt</span><span class="token punctuation">(</span>block_dft<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">%导频转换到频域</span>


<span class="token comment">%rayleighchan = comm.RayleighChannel;</span>
<span class="token comment">%rayleighchan.SampleRate = 7.5e6;</span>
<span class="token comment">%rayleighchan.PathGainsOutputPort=1;</span>
<span class="token comment">%rayleighchan.PathDelays = [0,30e-9,150e-9,310e-9,370e-9,710e-9,1090e-9,1370e-9,2510e-9];</span>
<span class="token comment">%rayleighchan.PathDelays = [0];%1/7.5e6];%,2/7.5e6,3/7.5e6,4/7.5e6];%,5/7.5e6,6/7.5e6,7/7.5e6,8/7.5e6];</span>
<span class="token comment">%rayleighchan.AveragePathGains=[0,-1.5,-1.4,-3.6,-0.6,-9.1,-7.0,-12.0,-16.9];</span>
<span class="token comment">%rayleighchan.MaximumDopplerShift = 50;</span>

snr <span class="token operator">=</span> <span class="token number">4</span><span class="token operator">:</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">12</span><span class="token punctuation">;</span><span class="token comment">% [4, 5, 6, 7, 8, 9, 10, 11, 12]</span>
err_rate<span class="token operator">=</span><span class="token function">zeros</span><span class="token punctuation">(</span><span class="token function">size</span><span class="token punctuation">(</span>snr<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
nframes <span class="token operator">=</span> <span class="token number">1000</span><span class="token punctuation">;</span><span class="token comment">%传输1000帧</span>
<span class="token keyword">for</span> nsnr <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">:</span><span class="token function">length</span><span class="token punctuation">(</span>snr<span class="token punctuation">)</span><span class="token comment">%SNR循环,nsnr是索引</span>
    sigma <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">/</span><span class="token function">sqrt</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token operator">*</span><span class="token number">10</span><span class="token operator">^</span><span class="token punctuation">(</span><span class="token function">snr</span><span class="token punctuation">(</span>nsnr<span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">%*sqrt(8);标准差`</span>
    total_err<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> nfr <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">:</span>nframes <span class="token comment">%帧循环</span>
        bit_fr <span class="token operator">=</span> <span class="token function">randsrc</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token operator">*</span>num_block<span class="token operator">*</span>block<span class="token operator">*</span>num_sf<span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">%生成一个子帧的所有比特（1、0） 因为qpsk所以×2</span>
        rbits <span class="token operator">=</span> <span class="token function">zeros</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token operator">*</span>num_block<span class="token operator">*</span>block<span class="token operator">*</span>num_sf<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> nsf <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">:</span>num_sf <span class="token comment">%子帧循环</span>
            bit <span class="token operator">=</span> <span class="token function">bit_fr</span><span class="token punctuation">(</span><span class="token punctuation">(</span>nsf<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">2</span><span class="token operator">*</span>num_block<span class="token operator">*</span>block<span class="token operator">+</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">2</span><span class="token operator">*</span>nsf<span class="token operator">*</span>num_block<span class="token operator">*</span>block<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">%每个子帧存储成行向量bit</span>
            bit0 <span class="token operator">=</span> <span class="token function">bit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">2</span><span class="token operator">:</span><span class="token keyword">end</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">%I路:取1 3 5 7bit</span>
            bit1 <span class="token operator">=</span> <span class="token function">bit</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token operator">:</span><span class="token number">2</span><span class="token operator">:</span><span class="token keyword">end</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">%Q路: 偶数bit</span>
            data <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">-</span><span class="token number">2.</span><span class="token operator">*</span>bit0<span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1j</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">-</span><span class="token number">2</span><span class="token operator">*</span>bit1<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token function">sqrt</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">%归一化(电平映射从0/1映射到-1/1):QPSK</span>
            tx_sframe <span class="token operator">=</span> <span class="token function">zeros</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">(</span>CP<span class="token operator">+</span>block<span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span>num_block<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">tx_sframe</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">:</span>CP<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">p</span><span class="token punctuation">(</span>block<span class="token operator">-</span>CP<span class="token operator">+</span><span class="token number">1</span><span class="token operator">:</span>block<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">%构造导频的CP（取p后几个作为cp）</span>
            <span class="token function">tx_sframe</span><span class="token punctuation">(</span>CP<span class="token operator">+</span><span class="token number">1</span><span class="token operator">:</span>block_dft<span class="token operator">+</span>CP<span class="token punctuation">)</span> <span class="token operator">=</span> p<span class="token punctuation">;</span><span class="token comment">%构造子帧的导频</span>
            <span class="token keyword">for</span> <span class="token number">i</span><span class="token operator">=</span><span class="token number">1</span><span class="token operator">:</span>num_block<span class="token comment">%FDE块数循环</span>
                  <span class="token comment">%对每个数据块扩频</span>
                  <span class="token comment">% DFT 扩频</span>
                <span class="token function">fft_block</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">i</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span>block_dft<span class="token operator">+</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">i</span><span class="token operator">*</span>block_dft<span class="token punctuation">)</span><span class="token operator">=</span> <span class="token function">zero_insertion</span><span class="token punctuation">(</span><span class="token function">fft</span><span class="token punctuation">(</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">i</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span>block<span class="token operator">+</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">i</span><span class="token operator">*</span>block<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                
                <span class="token function">ifft_block</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">i</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span>block_dft<span class="token operator">+</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">i</span><span class="token operator">*</span>block_dft<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">ifft</span><span class="token punctuation">(</span><span class="token function">fft_block</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">i</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span>block_dft<span class="token operator">+</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">i</span><span class="token operator">*</span>block_dft<span class="token punctuation">)</span><span class="token punctuation">,</span>block_dft<span class="token punctuation">)</span><span class="token punctuation">;</span> 
                
                <span class="token function">tx_sframe</span><span class="token punctuation">(</span><span class="token number">i</span><span class="token operator">*</span><span class="token punctuation">(</span>CP<span class="token operator">+</span>block_dft<span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">i</span><span class="token operator">*</span><span class="token punctuation">(</span>CP<span class="token operator">+</span>block_dft<span class="token punctuation">)</span><span class="token operator">+</span>CP<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">ifft_block</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">i</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span>block_dft<span class="token operator">+</span><span class="token punctuation">(</span>block_dft<span class="token operator">-</span>CP<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token number">i</span><span class="token operator">*</span>block_dft<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">%CP是后25个数据</span>
                <span class="token function">tx_sframe</span><span class="token punctuation">(</span><span class="token number">i</span><span class="token operator">*</span><span class="token punctuation">(</span>CP<span class="token operator">+</span>block_dft<span class="token punctuation">)</span><span class="token operator">+</span><span class="token punctuation">(</span>CP<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token number">i</span><span class="token operator">*</span><span class="token punctuation">(</span>CP<span class="token operator">+</span>block_dft<span class="token punctuation">)</span><span class="token operator">+</span><span class="token punctuation">(</span>CP<span class="token operator">+</span>block_dft<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">=</span>  <span class="token function">ifft_block</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">i</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span>block_dft<span class="token operator">+</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">i</span><span class="token operator">*</span>block_dft<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">end</span><span class="token comment">%一个子帧的数据</span>
            <span class="token function">tr_sym</span><span class="token punctuation">(</span><span class="token number">4097</span><span class="token operator">+</span><span class="token punctuation">(</span>nsf<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span>bpc<span class="token operator">*</span><span class="token punctuation">(</span>num_block<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token number">4096</span><span class="token operator">+</span>nsf<span class="token operator">*</span>bpc<span class="token operator">*</span><span class="token punctuation">(</span>num_block<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">=</span> tx_sframe<span class="token punctuation">;</span>
        <span class="token keyword">end</span>
        
        
        
        
     
        
        
       <span class="token comment">% 脉冲成型(A-&gt;D)</span>
        tr_sample <span class="token operator">=</span> <span class="token function">upfirdn</span><span class="token punctuation">(</span>tr_sym<span class="token punctuation">,</span> b<span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">%8倍过采样后过根升余弦滚降</span>
        tr_head <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token function">zeros</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span>tr_sample<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">%前面加上GP</span>
        

        <span class="token comment">%[rx_frame,pathgains] = rayleighchan(tx_frame.');</span>
        <span class="token comment">%h=[0.8, 0, 0, 0.4, 0.4472];</span>
        h<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token comment">%load tx_frame.mat</span>
        rx_frame <span class="token operator">=</span> <span class="token function">conv</span><span class="token punctuation">(</span>tr_head<span class="token punctuation">,</span>h<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">%理想信道卷积</span>
        <span class="token comment">%rx_frame = rx_frame.'+randn(size(rx_frame.'))*sigma+1j*randn(size(rx_frame.'))*sigma;</span>
        rx_frame <span class="token operator">=</span> rx_frame<span class="token punctuation">.</span><span class="token string">'+randn(size(rx_frame.'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">*</span>sigma<span class="token operator">+</span><span class="token number">1j</span><span class="token operator">*</span><span class="token function">randn</span><span class="token punctuation">(</span><span class="token function">size</span><span class="token punctuation">(</span>rx_frame<span class="token operator">.'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">*</span>sigma<span class="token punctuation">;</span>    
        <span class="token comment">%AWGN加噪声</span>
        
        
        
        <span class="token comment">%%%%%%%%%%%%%%%%%Receiver%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
        rx_rrc <span class="token operator">=</span> <span class="token function">conv</span><span class="token punctuation">(</span>rx_frame<span class="token punctuation">,</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">%根升余弦滚降</span>
        <span class="token comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
        

        <span class="token comment">%%%%%%%%%Synchronization%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
        rx_frame0 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token function">rx_rrc</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">8</span><span class="token operator">:</span><span class="token keyword">end</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">.'</span><span class="token punctuation">;</span>
        rx_frame4 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token function">rx_rrc</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token operator">:</span><span class="token number">8</span><span class="token operator">:</span><span class="token keyword">end</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">.'</span><span class="token punctuation">;</span>
        window0<span class="token operator">=</span><span class="token function">zeros</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">14</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        window4<span class="token operator">=</span><span class="token function">zeros</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">14</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> ii <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">:</span><span class="token number">14</span> <span class="token comment">%求十四次相关值</span>
            corr0 <span class="token operator">=</span> <span class="token function">conj</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token function">rx_frame0</span><span class="token punctuation">(</span>ii<span class="token operator">:</span>ii<span class="token operator">+</span><span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">.'</span><span class="token punctuation">;</span>
            <span class="token function">window0</span><span class="token punctuation">(</span>ii<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">abs</span><span class="token punctuation">(</span><span class="token function">real</span><span class="token punctuation">(</span>corr0<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">+</span> <span class="token function">abs</span><span class="token punctuation">(</span><span class="token function">imag</span><span class="token punctuation">(</span>corr0<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            corr4 <span class="token operator">=</span> <span class="token function">conj</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token function">rx_frame4</span><span class="token punctuation">(</span>ii<span class="token operator">:</span>ii<span class="token operator">+</span><span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">.'</span><span class="token punctuation">;</span>
            <span class="token function">window4</span><span class="token punctuation">(</span>ii<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">abs</span><span class="token punctuation">(</span><span class="token function">real</span><span class="token punctuation">(</span>corr4<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">+</span> <span class="token function">abs</span><span class="token punctuation">(</span><span class="token function">imag</span><span class="token punctuation">(</span>corr4<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">end</span>
        bit_syn_ok <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        flag0 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        flag4 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        ii <span class="token operator">=</span> ii<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">%求第十五次相关系数的I路和Q路的绝对值和（相关值）</span>
       <span class="token comment">%%%%%%%%%位同步%%%并行相关%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
        <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">~</span>bit_syn_ok<span class="token punctuation">)</span><span class="token comment">%%对连续的4个周期继续进行匹配滤波??</span>
             corr0 <span class="token operator">=</span> <span class="token function">conj</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token function">rx_frame0</span><span class="token punctuation">(</span>ii<span class="token operator">:</span>ii<span class="token operator">+</span><span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">.'</span><span class="token punctuation">;</span>
             abscorr0 <span class="token operator">=</span> <span class="token function">abs</span><span class="token punctuation">(</span><span class="token function">real</span><span class="token punctuation">(</span>corr0<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">+</span> <span class="token function">abs</span><span class="token punctuation">(</span><span class="token function">imag</span><span class="token punctuation">(</span>corr0<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
             sumw0 <span class="token operator">=</span> <span class="token function">sum</span><span class="token punctuation">(</span>window0<span class="token punctuation">)</span><span class="token punctuation">;</span>
             <span class="token keyword">if</span><span class="token punctuation">(</span>abscorr0<span class="token operator">&gt;=</span><span class="token number">0.75</span><span class="token operator">*</span>sumw0<span class="token punctuation">)</span><span class="token comment">%门限值是0.75</span>
                 bit_syn_ok <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
                 syn_pos <span class="token operator">=</span> ii<span class="token punctuation">;</span>
                 flag0 <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
                 <span class="token keyword">break</span><span class="token punctuation">;</span>
             <span class="token keyword">else</span>
                 window0<span class="token operator">=</span><span class="token punctuation">[</span><span class="token function">window0</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token operator">:</span><span class="token number">14</span><span class="token punctuation">)</span><span class="token punctuation">,</span>abscorr0<span class="token punctuation">]</span><span class="token punctuation">;</span>
                 <span class="token comment">%ii = ii+1;</span>
             <span class="token keyword">end</span>
             corr4 <span class="token operator">=</span> <span class="token function">conj</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token function">rx_frame4</span><span class="token punctuation">(</span>ii<span class="token operator">:</span>ii<span class="token operator">+</span><span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">.'</span><span class="token punctuation">;</span>
             abscorr4 <span class="token operator">=</span> <span class="token function">abs</span><span class="token punctuation">(</span><span class="token function">real</span><span class="token punctuation">(</span>corr4<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">+</span> <span class="token function">abs</span><span class="token punctuation">(</span><span class="token function">real</span><span class="token punctuation">(</span>corr4<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
             sumw4 <span class="token operator">=</span> <span class="token function">sum</span><span class="token punctuation">(</span>window4<span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token keyword">if</span><span class="token punctuation">(</span>abscorr4<span class="token operator">&gt;=</span><span class="token number">0.75</span><span class="token operator">*</span>sumw4<span class="token punctuation">)</span>
                 bit_syn_ok <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
                 syn_pos <span class="token operator">=</span> ii<span class="token punctuation">;</span>
                 flag4 <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
                 <span class="token keyword">break</span><span class="token punctuation">;</span>
             <span class="token keyword">else</span>
                 window4<span class="token operator">=</span><span class="token punctuation">[</span><span class="token function">window4</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token operator">:</span><span class="token number">14</span><span class="token punctuation">)</span><span class="token punctuation">,</span>abscorr4<span class="token punctuation">]</span><span class="token punctuation">;</span>
             <span class="token keyword">end</span>
             ii <span class="token operator">=</span> ii<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token keyword">end</span>
        <span class="token comment">%%%%%%%%% 最佳样值选择</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>flag0<span class="token punctuation">)</span>
            cor1 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token function">conj</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">conj</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">conj</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">conj</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token function">rx_rrc</span><span class="token punctuation">(</span><span class="token punctuation">(</span>ii<span class="token operator">+</span><span class="token number">14</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">8</span><span class="token operator">+</span><span class="token number">7</span><span class="token operator">:</span><span class="token number">8</span><span class="token operator">:</span><span class="token punctuation">(</span>ii<span class="token operator">+</span><span class="token number">77</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">8</span><span class="token operator">+</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">%ii=15</span>
            cor2 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token function">conj</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">conj</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">conj</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">conj</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token function">rx_rrc</span><span class="token punctuation">(</span><span class="token punctuation">(</span>ii<span class="token operator">+</span><span class="token number">14</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">8</span><span class="token operator">+</span><span class="token number">8</span><span class="token operator">:</span><span class="token number">8</span><span class="token operator">:</span><span class="token punctuation">(</span>ii<span class="token operator">+</span><span class="token number">77</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">8</span><span class="token operator">+</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            cor3 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token function">conj</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">conj</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">conj</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">conj</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token function">rx_rrc</span><span class="token punctuation">(</span><span class="token punctuation">(</span>ii<span class="token operator">+</span><span class="token number">15</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">8</span><span class="token operator">+</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">8</span><span class="token operator">:</span><span class="token punctuation">(</span>ii<span class="token operator">+</span><span class="token number">78</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">8</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            cor4 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token function">conj</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">conj</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">conj</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">conj</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token function">rx_rrc</span><span class="token punctuation">(</span><span class="token punctuation">(</span>ii<span class="token operator">+</span><span class="token number">15</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">8</span><span class="token operator">+</span><span class="token number">2</span><span class="token operator">:</span><span class="token number">8</span><span class="token operator">:</span><span class="token punctuation">(</span>ii<span class="token operator">+</span><span class="token number">78</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">8</span><span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            cor5 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token function">conj</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">conj</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">conj</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">conj</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token function">rx_rrc</span><span class="token punctuation">(</span><span class="token punctuation">(</span>ii<span class="token operator">+</span><span class="token number">15</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">8</span><span class="token operator">+</span><span class="token number">3</span><span class="token operator">:</span><span class="token number">8</span><span class="token operator">:</span><span class="token punctuation">(</span>ii<span class="token operator">+</span><span class="token number">78</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">8</span><span class="token operator">+</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            cor6 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token function">conj</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">conj</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">conj</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">conj</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token function">rx_rrc</span><span class="token punctuation">(</span><span class="token punctuation">(</span>ii<span class="token operator">+</span><span class="token number">15</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">8</span><span class="token operator">+</span><span class="token number">4</span><span class="token operator">:</span><span class="token number">8</span><span class="token operator">:</span><span class="token punctuation">(</span>ii<span class="token operator">+</span><span class="token number">78</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">8</span><span class="token operator">+</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            cor7 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token function">conj</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">conj</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">conj</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">conj</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token function">rx_rrc</span><span class="token punctuation">(</span><span class="token punctuation">(</span>ii<span class="token operator">+</span><span class="token number">15</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">8</span><span class="token operator">+</span><span class="token number">5</span><span class="token operator">:</span><span class="token number">8</span><span class="token operator">:</span><span class="token punctuation">(</span>ii<span class="token operator">+</span><span class="token number">78</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">8</span><span class="token operator">+</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            cor8 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token function">conj</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">conj</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">conj</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">conj</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token function">rx_rrc</span><span class="token punctuation">(</span><span class="token punctuation">(</span>ii<span class="token operator">+</span><span class="token number">15</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">8</span><span class="token operator">+</span><span class="token number">6</span><span class="token operator">:</span><span class="token number">8</span><span class="token operator">:</span><span class="token punctuation">(</span>ii<span class="token operator">+</span><span class="token number">78</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">8</span><span class="token operator">+</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            abscor <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token function">abs</span><span class="token punctuation">(</span><span class="token function">real</span><span class="token punctuation">(</span>cor1<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token function">abs</span><span class="token punctuation">(</span><span class="token function">imag</span><span class="token punctuation">(</span>cor1<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">abs</span><span class="token punctuation">(</span><span class="token function">real</span><span class="token punctuation">(</span>cor2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token function">abs</span><span class="token punctuation">(</span><span class="token function">imag</span><span class="token punctuation">(</span>cor2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">abs</span><span class="token punctuation">(</span><span class="token function">real</span><span class="token punctuation">(</span>cor3<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token function">abs</span><span class="token punctuation">(</span><span class="token function">imag</span><span class="token punctuation">(</span>cor3<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">...</span>
            <span class="token function">abs</span><span class="token punctuation">(</span><span class="token function">real</span><span class="token punctuation">(</span>cor4<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token function">abs</span><span class="token punctuation">(</span><span class="token function">imag</span><span class="token punctuation">(</span>cor4<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">abs</span><span class="token punctuation">(</span><span class="token function">real</span><span class="token punctuation">(</span>cor5<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token function">abs</span><span class="token punctuation">(</span><span class="token function">imag</span><span class="token punctuation">(</span>cor5<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">abs</span><span class="token punctuation">(</span><span class="token function">real</span><span class="token punctuation">(</span>cor6<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token function">abs</span><span class="token punctuation">(</span><span class="token function">imag</span><span class="token punctuation">(</span>cor6<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">...</span>
            <span class="token function">abs</span><span class="token punctuation">(</span><span class="token function">real</span><span class="token punctuation">(</span>cor7<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token function">abs</span><span class="token punctuation">(</span><span class="token function">imag</span><span class="token punctuation">(</span>cor7<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">abs</span><span class="token punctuation">(</span><span class="token function">real</span><span class="token punctuation">(</span>cor8<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token function">abs</span><span class="token punctuation">(</span><span class="token function">imag</span><span class="token punctuation">(</span>cor8<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token punctuation">[</span>maxabs<span class="token punctuation">,</span>pos<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">max</span><span class="token punctuation">(</span>abscor<span class="token punctuation">)</span><span class="token punctuation">;</span>
            position <span class="token operator">=</span> <span class="token punctuation">(</span>ii<span class="token operator">+</span><span class="token number">79</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">8</span><span class="token operator">+</span>pos<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span>
            cor1 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token function">conj</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">conj</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">conj</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">conj</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token function">rx_rrc</span><span class="token punctuation">(</span><span class="token punctuation">(</span>ii<span class="token operator">+</span><span class="token number">15</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">8</span><span class="token operator">+</span><span class="token number">3</span><span class="token operator">:</span><span class="token number">8</span><span class="token operator">:</span><span class="token punctuation">(</span>ii<span class="token operator">+</span><span class="token number">78</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">8</span><span class="token operator">+</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            cor2 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token function">conj</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">conj</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">conj</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">conj</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token function">rx_rrc</span><span class="token punctuation">(</span><span class="token punctuation">(</span>ii<span class="token operator">+</span><span class="token number">15</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">8</span><span class="token operator">+</span><span class="token number">4</span><span class="token operator">:</span><span class="token number">8</span><span class="token operator">:</span><span class="token punctuation">(</span>ii<span class="token operator">+</span><span class="token number">78</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">8</span><span class="token operator">+</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            cor3 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token function">conj</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">conj</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">conj</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">conj</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token function">rx_rrc</span><span class="token punctuation">(</span><span class="token punctuation">(</span>ii<span class="token operator">+</span><span class="token number">15</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">8</span><span class="token operator">+</span><span class="token number">5</span><span class="token operator">:</span><span class="token number">8</span><span class="token operator">:</span><span class="token punctuation">(</span>ii<span class="token operator">+</span><span class="token number">78</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">8</span><span class="token operator">+</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            cor4 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token function">conj</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">conj</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">conj</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">conj</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token function">rx_rrc</span><span class="token punctuation">(</span><span class="token punctuation">(</span>ii<span class="token operator">+</span><span class="token number">15</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">8</span><span class="token operator">+</span><span class="token number">6</span><span class="token operator">:</span><span class="token number">8</span><span class="token operator">:</span><span class="token punctuation">(</span>ii<span class="token operator">+</span><span class="token number">78</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">8</span><span class="token operator">+</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            cor5 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token function">conj</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">conj</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">conj</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">conj</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token function">rx_rrc</span><span class="token punctuation">(</span><span class="token punctuation">(</span>ii<span class="token operator">+</span><span class="token number">15</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">8</span><span class="token operator">+</span><span class="token number">7</span><span class="token operator">:</span><span class="token number">8</span><span class="token operator">:</span><span class="token punctuation">(</span>ii<span class="token operator">+</span><span class="token number">78</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">8</span><span class="token operator">+</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            cor6 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token function">conj</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">conj</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">conj</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">conj</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token function">rx_rrc</span><span class="token punctuation">(</span><span class="token punctuation">(</span>ii<span class="token operator">+</span><span class="token number">15</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">8</span><span class="token operator">+</span><span class="token number">8</span><span class="token operator">:</span><span class="token number">8</span><span class="token operator">:</span><span class="token punctuation">(</span>ii<span class="token operator">+</span><span class="token number">78</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">8</span><span class="token operator">+</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            cor7 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token function">conj</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">conj</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">conj</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">conj</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token function">rx_rrc</span><span class="token punctuation">(</span><span class="token punctuation">(</span>ii<span class="token operator">+</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">8</span><span class="token operator">+</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">8</span><span class="token operator">:</span><span class="token punctuation">(</span>ii<span class="token operator">+</span><span class="token number">79</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">8</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            cor8 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token function">conj</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">conj</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">conj</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">conj</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token function">rx_rrc</span><span class="token punctuation">(</span><span class="token punctuation">(</span>ii<span class="token operator">+</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">8</span><span class="token operator">+</span><span class="token number">2</span><span class="token operator">:</span><span class="token number">8</span><span class="token operator">:</span><span class="token punctuation">(</span>ii<span class="token operator">+</span><span class="token number">79</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">8</span><span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            abscor <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token function">abs</span><span class="token punctuation">(</span><span class="token function">real</span><span class="token punctuation">(</span>cor1<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token function">abs</span><span class="token punctuation">(</span><span class="token function">imag</span><span class="token punctuation">(</span>cor1<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">abs</span><span class="token punctuation">(</span><span class="token function">real</span><span class="token punctuation">(</span>cor2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token function">abs</span><span class="token punctuation">(</span><span class="token function">imag</span><span class="token punctuation">(</span>cor2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">abs</span><span class="token punctuation">(</span><span class="token function">real</span><span class="token punctuation">(</span>cor3<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token function">abs</span><span class="token punctuation">(</span><span class="token function">imag</span><span class="token punctuation">(</span>cor3<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">...</span>
                <span class="token function">abs</span><span class="token punctuation">(</span><span class="token function">real</span><span class="token punctuation">(</span>cor4<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token function">abs</span><span class="token punctuation">(</span><span class="token function">imag</span><span class="token punctuation">(</span>cor4<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">abs</span><span class="token punctuation">(</span><span class="token function">real</span><span class="token punctuation">(</span>cor5<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token function">abs</span><span class="token punctuation">(</span><span class="token function">imag</span><span class="token punctuation">(</span>cor5<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">abs</span><span class="token punctuation">(</span><span class="token function">real</span><span class="token punctuation">(</span>cor6<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token function">abs</span><span class="token punctuation">(</span><span class="token function">imag</span><span class="token punctuation">(</span>cor6<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">...</span>
                <span class="token function">abs</span><span class="token punctuation">(</span><span class="token function">real</span><span class="token punctuation">(</span>cor7<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token function">abs</span><span class="token punctuation">(</span><span class="token function">imag</span><span class="token punctuation">(</span>cor7<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">abs</span><span class="token punctuation">(</span><span class="token function">real</span><span class="token punctuation">(</span>cor8<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token function">abs</span><span class="token punctuation">(</span><span class="token function">imag</span><span class="token punctuation">(</span>cor8<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token punctuation">[</span>maxabs<span class="token punctuation">,</span>pos<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">max</span><span class="token punctuation">(</span>abscor<span class="token punctuation">)</span><span class="token punctuation">;</span>
            position <span class="token operator">=</span> <span class="token punctuation">(</span>ii<span class="token operator">+</span><span class="token number">79</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">8</span><span class="token operator">+</span>pos<span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">;</span>
        <span class="token keyword">end</span>
        
        <span class="token comment">%position</span>
        pre_cor <span class="token operator">=</span> <span class="token function">conj</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token operator">*</span><span class="token function">rx_rrc</span><span class="token punctuation">(</span>position<span class="token operator">:</span><span class="token number">8</span><span class="token operator">:</span>position<span class="token operator">+</span><span class="token number">15</span><span class="token operator">*</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        frame_syn <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        curr <span class="token operator">=</span> position<span class="token punctuation">;</span>
        <span class="token keyword">while</span><span class="token punctuation">(</span>frame_syn<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span>
            curr <span class="token operator">=</span> curr<span class="token operator">+</span><span class="token number">16</span><span class="token operator">*</span><span class="token number">8</span><span class="token punctuation">;</span>
            curr_cor <span class="token operator">=</span> <span class="token function">conj</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token operator">*</span><span class="token function">rx_rrc</span><span class="token punctuation">(</span>curr<span class="token operator">:</span><span class="token number">8</span><span class="token operator">:</span>curr<span class="token operator">+</span><span class="token number">15</span><span class="token operator">*</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            xc <span class="token operator">=</span> pre_cor<span class="token operator">*</span><span class="token function">conj</span><span class="token punctuation">(</span>curr_cor<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">real</span><span class="token punctuation">(</span>xc<span class="token punctuation">)</span><span class="token operator">&lt;</span><span class="token number">0</span><span class="token punctuation">)</span>
                frame_syn <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
            <span class="token keyword">else</span>
                pre_cor <span class="token operator">=</span> curr_cor<span class="token punctuation">;</span>
            <span class="token keyword">end</span>
        <span class="token keyword">end</span>
        data_for_fre_offsetEst <span class="token operator">=</span> <span class="token function">rx_rrc</span><span class="token punctuation">(</span>curr<span class="token operator">:</span><span class="token number">8</span><span class="token operator">:</span>curr<span class="token operator">+</span><span class="token number">3839</span><span class="token operator">*</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">%用于频偏估计</span>
        data_for_fre_offsetCmp <span class="token operator">=</span> <span class="token function">rx_rrc</span><span class="token punctuation">(</span>curr<span class="token operator">+</span><span class="token number">3840</span><span class="token operator">*</span><span class="token number">8</span><span class="token operator">:</span><span class="token number">8</span><span class="token operator">:</span><span class="token keyword">end</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">%用于频偏补偿</span>
        
       <span class="token comment">%%%%%%%%%%%%%%%%%%%%频偏估计%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
       <span class="token comment">% 用于频偏估计的长度为3840个符号的前导序列</span>
        corr_res <span class="token operator">=</span> <span class="token function">zeros</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">240</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">%与本地存储的序列进行相关计算，得到240个相关值，在这些相关值后面补3856个零</span>
        <span class="token keyword">for</span> <span class="token number">i</span><span class="token operator">=</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">16</span><span class="token operator">:</span><span class="token number">3840</span>
            <span class="token function">corr_res</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">i</span><span class="token operator">+</span><span class="token number">15</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token function">conj</span><span class="token punctuation">(</span><span class="token operator">-</span>s1<span class="token punctuation">)</span><span class="token operator">*</span><span class="token function">data_for_fre_offsetEst</span><span class="token punctuation">(</span><span class="token number">i</span><span class="token operator">:</span><span class="token number">i</span><span class="token operator">+</span><span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">end</span>
       <span class="token comment">%得到的corr_res做4096点FFT(基于FFT进行最大似然频偏估计)</span>
        fft_value <span class="token operator">=</span> <span class="token function">fft</span><span class="token punctuation">(</span>corr_res<span class="token punctuation">,</span><span class="token number">4096</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">%对fft_value求模平方</span>
        fft_value<span class="token operator">=</span><span class="token function">real</span><span class="token punctuation">(</span>fft_value<span class="token punctuation">)</span><span class="token operator">.*</span><span class="token function">real</span><span class="token punctuation">(</span>fft_value<span class="token punctuation">)</span><span class="token operator">+</span><span class="token function">imag</span><span class="token punctuation">(</span>fft_value<span class="token punctuation">)</span><span class="token operator">.*</span><span class="token function">imag</span><span class="token punctuation">(</span>fft_value<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">%找最大值，记录最大值所在的位置索引loca_tmp</span>
        <span class="token punctuation">[</span>fft_value1<span class="token punctuation">,</span>loca_tmp<span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">max</span><span class="token punctuation">(</span>fft_value<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token comment">%进行二次插值</span>
         <span class="token comment">%求最大值左边一个位置的值</span>
        fft_value0<span class="token operator">=</span><span class="token function">fft_value</span><span class="token punctuation">(</span><span class="token function">mod</span><span class="token punctuation">(</span><span class="token punctuation">(</span>loca_tmp<span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">4096</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
        <span class="token comment">%求最大值右边一个位置的值</span>
        fft_value2<span class="token operator">=</span><span class="token function">fft_value</span><span class="token punctuation">(</span><span class="token function">mod</span><span class="token punctuation">(</span>loca_tmp<span class="token punctuation">,</span><span class="token number">4096</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">%根据公式拟合出二次函数，并找到最大值</span>
        <span class="token comment">% 频率偏移值</span>
        fre_off_est<span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">(</span>loca_tmp<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token punctuation">(</span>fft_value0<span class="token operator">-</span>fft_value2<span class="token punctuation">)</span><span class="token operator">/</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token operator">*</span>fft_value0<span class="token operator">-</span><span class="token number">4</span><span class="token operator">*</span>fft_value1<span class="token operator">+</span><span class="token number">2</span><span class="token operator">*</span>fft_value2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span>rate<span class="token operator">/</span><span class="token number">16</span><span class="token operator">/</span><span class="token number">4096</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        
        <span class="token comment">%%%%%%%%%%%%%%%%%%%频偏补偿%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
        t <span class="token operator">=</span> <span class="token number">0</span><span class="token operator">:</span><span class="token number">1</span><span class="token operator">/</span>rate<span class="token operator">:</span><span class="token punctuation">(</span><span class="token function">length</span><span class="token punctuation">(</span>data_for_fre_offsetCmp<span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">/</span>rate<span class="token punctuation">;</span>
        data_for_EstEqu <span class="token operator">=</span> data_for_fre_offsetCmp<span class="token operator">.'</span><span class="token operator">.*</span><span class="token function">exp</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1j</span><span class="token operator">*</span><span class="token number">2</span><span class="token operator">*</span><span class="token keyword">pi</span><span class="token operator">*</span>fre_off_est<span class="token operator">.*</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">%%%%%%%%%%%%%%%%%%提取信息%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
        <span class="token keyword">for</span> nsf <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">:</span>num_sf
           
            rx_frame <span class="token operator">=</span> <span class="token function">data_for_EstEqu</span><span class="token punctuation">(</span><span class="token punctuation">(</span>nsf<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">3759</span><span class="token operator">+</span><span class="token number">1</span><span class="token operator">:</span>nsf<span class="token operator">*</span><span class="token number">3759</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            pilot_r <span class="token operator">=</span> <span class="token function">rx_frame</span><span class="token punctuation">(</span>CP<span class="token operator">+</span><span class="token number">1</span><span class="token operator">:</span>CP<span class="token operator">+</span>block_dft<span class="token punctuation">)</span><span class="token punctuation">;</span>
            data_r <span class="token operator">=</span> <span class="token function">zeros</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>num_block<span class="token operator">*</span>block_dft<span class="token punctuation">)</span><span class="token punctuation">;</span>
            f_data_r <span class="token operator">=</span> <span class="token function">zeros</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>num_block<span class="token operator">*</span>block_dft<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span> <span class="token number">i</span><span class="token operator">=</span><span class="token number">1</span><span class="token operator">:</span>num_block
                <span class="token function">data_r</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">i</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span>block_dft<span class="token operator">+</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">i</span><span class="token operator">*</span>block_dft<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">rx_frame</span><span class="token punctuation">(</span><span class="token number">i</span><span class="token operator">*</span><span class="token punctuation">(</span>CP<span class="token operator">+</span>block_dft<span class="token punctuation">)</span><span class="token operator">+</span>CP<span class="token operator">+</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">i</span><span class="token operator">*</span><span class="token punctuation">(</span>CP<span class="token operator">+</span>block_dft<span class="token punctuation">)</span><span class="token operator">+</span><span class="token punctuation">(</span>CP<span class="token operator">+</span>block_dft<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
                <span class="token function">f_data_r</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">i</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span>block_dft<span class="token operator">+</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">i</span><span class="token operator">*</span>block_dft<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">fft</span><span class="token punctuation">(</span><span class="token function">data_r</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">i</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span>block_dft<span class="token operator">+</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">i</span><span class="token operator">*</span>block_dft<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token function">sqrt</span><span class="token punctuation">(</span>block_dft<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">end</span>
            <span class="token comment">%对子帧的导频做fft,进行信道估计</span>
            f_pilot_r <span class="token operator">=</span> <span class="token function">fft</span><span class="token punctuation">(</span>pilot_r<span class="token punctuation">)</span><span class="token operator">/</span><span class="token function">sqrt</span><span class="token punctuation">(</span>block_dft<span class="token punctuation">)</span><span class="token punctuation">;</span>
            r_for_sigma<span class="token operator">=</span><span class="token function">f_pilot_r</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span> <span class="token number">i</span><span class="token operator">=</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">63</span>
                r_for_sigma<span class="token operator">=</span><span class="token punctuation">[</span>r_for_sigma<span class="token punctuation">,</span><span class="token function">f_pilot_r</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">i</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span>block_dft<span class="token operator">/</span><span class="token number">64</span><span class="token operator">+</span><span class="token number">6</span><span class="token operator">:</span><span class="token punctuation">(</span><span class="token number">i</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span>block_dft<span class="token operator">/</span><span class="token number">64</span><span class="token operator">+</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token keyword">end</span>
            r_for_sigma<span class="token operator">=</span><span class="token punctuation">[</span>r_for_sigma<span class="token punctuation">,</span><span class="token function">f_pilot_r</span><span class="token punctuation">(</span><span class="token number">510</span><span class="token operator">:</span><span class="token number">512</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            sigma_est <span class="token operator">=</span> <span class="token function">sqrt</span><span class="token punctuation">(</span><span class="token function">mean</span><span class="token punctuation">(</span><span class="token function">abs</span><span class="token punctuation">(</span>r_for_sigma<span class="token punctuation">)</span><span class="token operator">.^</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            pace<span class="token operator">=</span>block_dft<span class="token operator">/</span><span class="token number">64</span><span class="token punctuation">;</span>
            h_est <span class="token operator">=</span> <span class="token function">f_pilot_r</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token operator">:</span>pace<span class="token operator">:</span><span class="token keyword">end</span><span class="token punctuation">)</span><span class="token operator">./</span><span class="token function">f_pilot</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token operator">:</span>pace<span class="token operator">:</span><span class="token keyword">end</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            h_est_interp <span class="token operator">=</span> <span class="token function">zeros</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>block_dft<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span> <span class="token number">i</span><span class="token operator">=</span><span class="token number">2</span><span class="token operator">:</span><span class="token number">64</span>
                delta <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token function">h_est</span><span class="token punctuation">(</span><span class="token number">i</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token function">h_est</span><span class="token punctuation">(</span><span class="token number">i</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">8</span><span class="token punctuation">;</span>
                <span class="token keyword">for</span> k<span class="token operator">=</span><span class="token number">1</span><span class="token operator">:</span>block_dft<span class="token operator">/</span><span class="token number">64</span>
                    <span class="token function">h_est_interp</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">i</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">8</span><span class="token operator">+</span>k<span class="token operator">+</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">h_est</span><span class="token punctuation">(</span><span class="token number">i</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token punctuation">(</span>k<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span>delta<span class="token punctuation">;</span>
                <span class="token keyword">end</span>
            <span class="token keyword">end</span>
            delta <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token function">h_est</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token function">h_est</span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">8</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span> k<span class="token operator">=</span><span class="token number">509</span><span class="token operator">:</span><span class="token number">512</span>
                <span class="token function">h_est_interp</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">h_est</span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token punctuation">(</span>k<span class="token operator">-</span><span class="token number">509</span><span class="token punctuation">)</span><span class="token operator">*</span>delta<span class="token punctuation">;</span>
            <span class="token keyword">end</span>
            <span class="token keyword">for</span> k<span class="token operator">=</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">4</span>
                <span class="token function">h_est_interp</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">h_est</span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token punctuation">(</span>k<span class="token operator">+</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token operator">*</span>delta<span class="token punctuation">;</span>
            <span class="token keyword">end</span>
     
            
            
            comp <span class="token operator">=</span> <span class="token function">zeros</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>num_block<span class="token operator">*</span>block_dft<span class="token punctuation">)</span><span class="token punctuation">;</span>
            r_cons <span class="token operator">=</span> <span class="token function">zeros</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>num_block<span class="token operator">*</span>block<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span> <span class="token number">i</span><span class="token operator">=</span><span class="token number">1</span><span class="token operator">:</span>num_block
                <span class="token keyword">for</span> k<span class="token operator">=</span><span class="token number">1</span><span class="token operator">:</span>block_dft
                    <span class="token function">comp</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">i</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span>block_dft<span class="token operator">+</span>k<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">f_data_r</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">i</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span>block_dft<span class="token operator">+</span>k<span class="token punctuation">)</span><span class="token operator">*</span><span class="token function">conj</span><span class="token punctuation">(</span><span class="token function">h_est_interp</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token punctuation">(</span><span class="token function">h_est_interp</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token operator">*</span><span class="token function">conj</span><span class="token punctuation">(</span><span class="token function">h_est_interp</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">+</span>sigma_est<span class="token operator">*</span>sigma_est<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">end</span>
                <span class="token function">f_data_remov</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">i</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span>block<span class="token operator">+</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">i</span><span class="token operator">*</span>block<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">zero_removal</span><span class="token punctuation">(</span><span class="token function">comp</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">i</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span>block_dft<span class="token operator">+</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">i</span><span class="token operator">*</span>block_dft<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">r_cons</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">i</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span>block<span class="token operator">+</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">i</span><span class="token operator">*</span>block<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">ifft</span><span class="token punctuation">(</span><span class="token function">f_data_remov</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">i</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span>block<span class="token operator">+</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">i</span><span class="token operator">*</span>block<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token function">sqrt</span><span class="token punctuation">(</span>block<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">end</span>
            rsyms <span class="token operator">=</span> <span class="token function">reshape</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token function">real</span><span class="token punctuation">(</span>r_cons<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">imag</span><span class="token punctuation">(</span>r_cons<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token operator">*</span>num_block<span class="token operator">*</span>block<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">rbits</span><span class="token punctuation">(</span><span class="token punctuation">(</span>nsf<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">2</span><span class="token operator">*</span>num_block<span class="token operator">*</span>block<span class="token operator">+</span><span class="token number">1</span><span class="token operator">:</span>nsf<span class="token operator">*</span><span class="token number">2</span><span class="token operator">*</span>num_block<span class="token operator">*</span>block<span class="token punctuation">)</span> <span class="token operator">=</span> rsyms<span class="token operator">&lt;</span><span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token comment">%小于0 为1</span>
        <span class="token keyword">end</span>
          tbits <span class="token operator">=</span> bit_fr<span class="token operator">==</span><span class="token number">1</span><span class="token punctuation">;</span>
         <span class="token punctuation">[</span>err_count<span class="token punctuation">,</span>err_rate<span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">biterr</span><span class="token punctuation">(</span>tbits<span class="token punctuation">,</span>rbits<span class="token punctuation">)</span><span class="token punctuation">;</span>
         total_err <span class="token operator">=</span> total_err<span class="token operator">+</span>err_count<span class="token punctuation">;</span>
    <span class="token keyword">end</span>
    <span class="token function">disp</span><span class="token punctuation">(</span><span class="token string">'准备打印图片'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token function">err_rate1</span><span class="token punctuation">(</span>nsnr<span class="token punctuation">)</span><span class="token operator">=</span>total_err<span class="token operator">/</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token operator">*</span>num_block<span class="token operator">*</span>block<span class="token operator">*</span>num_sf<span class="token operator">*</span>nframes<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
<span class="token keyword">end</span>
    
  figure
  <span class="token function">semilogy</span><span class="token punctuation">(</span>snr<span class="token punctuation">,</span>err_rate1<span class="token punctuation">)</span><span class="token punctuation">;</span>             
        <span class="token comment">%rx_frame = tx_frame;</span>

<span class="token comment">%     end</span>
<span class="token comment">% err_rate(nsnr)=total_err/(2*num_block*block*nframes);</span>
<span class="token comment">% end</span>

<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="https://chilh.top">chilh</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://chilh.top/post/DFT-S-OFDM.html">https://chilh.top/post/DFT-S-OFDM.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://chilh.top" target="_blank">Chilh</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/4G/">4G</a></div><div class="post_share"><div class="social-share" data-image="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202307211649897.jpg" data-sites="twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/post/%E9%98%BB%E5%A1%9E%E8%B5%8B%E5%80%BC%E5%92%8C%E9%9D%9E%E9%98%BB%E5%A1%9E%E8%B5%8B%E5%80%BC%E7%9A%84%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF.html" title="阻塞赋值和非阻塞赋值的应用场景"><img class="cover" src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202307121444978.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">阻塞赋值和非阻塞赋值的应用场景</div></div></a></div><div class="next-post pull-right"><a href="/post/ysyx%E9%A2%84%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95-pa1.html" title="ysyx预学习记录--pa1"><img class="cover" src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202308101531521.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">ysyx预学习记录--pa1</div></div></a></div></nav><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="waline-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/%E5%A4%B4%E5%83%8F.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">chilh</div><div class="author-info__description">记录学习笔记，学艺不精，大家多多评论指教</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">70</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">20</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">7</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="mailto:1547405085@qq.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">1.</span> <span class="toc-text">DFT-S-OFDM</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A2%84%E5%A4%87%E7%9F%A5%E8%AF%86"><span class="toc-number">1.1.</span> <span class="toc-text">预备知识</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%9A%E5%9D%80%E5%92%8C%E5%A4%8D%E7%94%A8%EF%BC%88FDM%EF%BC%89"><span class="toc-number">1.1.1.</span> <span class="toc-text">多址和复用（FDM）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%B4%E6%8E%A5%E6%89%A9%E9%A2%91"><span class="toc-number">1.1.2.</span> <span class="toc-text">直接扩频</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8E%9F%E7%90%86"><span class="toc-number">1.2.</span> <span class="toc-text">原理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#OFDM%E7%9A%84%E8%B0%83%E5%88%B6%E6%A1%86%E5%9B%BE"><span class="toc-number">1.2.1.</span> <span class="toc-text">OFDM的调制框图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DFT%E6%89%A9%E9%A2%91"><span class="toc-number">1.2.2.</span> <span class="toc-text">DFT扩频</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%89%A9%E9%A2%91%E6%95%B0%E5%AD%A6%E8%A1%A8%E7%A4%BA"><span class="toc-number">1.2.2.1.</span> <span class="toc-text">扩频数学表示</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%BE%E8%AE%A1%E6%B5%81%E7%A8%8B"><span class="toc-number">1.3.</span> <span class="toc-text">设计流程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%84%E7%90%86%E6%B5%81%E7%A8%8B"><span class="toc-number">1.3.1.</span> <span class="toc-text">处理流程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%A7%E7%BB%93%E6%9E%84"><span class="toc-number">1.3.2.</span> <span class="toc-text">帧结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%8D%E5%90%8C%E6%AD%A5%E6%96%B9%E6%A1%88"><span class="toc-number">1.3.3.</span> <span class="toc-text">*位同步方案*</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%A7%E5%90%8C%E6%AD%A5%E6%96%B9%E6%A1%88"><span class="toc-number">1.3.4.</span> <span class="toc-text">帧同步方案</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%A2%91%E5%81%8F%E4%BC%B0%E8%AE%A1%E6%96%B9%E6%A1%88"><span class="toc-number">1.3.4.1.</span> <span class="toc-text">频偏估计方案</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%A2%91%E5%81%8F%E8%A1%A5%E5%81%BF%E6%96%B9%E6%A1%88"><span class="toc-number">1.3.4.2.</span> <span class="toc-text">频偏补偿方案</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BC%B0%E8%AE%A1%E4%B8%8E%E5%99%AA%E5%A3%B0%E6%96%B9%E5%B7%AE%E4%BC%B0%E8%AE%A1%E6%96%B9%E6%A1%88"><span class="toc-number">1.3.4.3.</span> <span class="toc-text">估计与噪声方差估计方案</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%A2%91%E5%9F%9F%E5%9D%87%E8%A1%A1%E6%96%B9%E6%A1%88"><span class="toc-number">1.3.4.4.</span> <span class="toc-text">频域均衡方案</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#matlab%E4%BB%A3%E7%A0%81"><span class="toc-number">1.4.</span> <span class="toc-text">matlab代码</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/post/%E7%BC%93%E5%AD%98%E6%9B%BF%E6%8D%A2%E7%AE%97%E6%B3%951-%E7%B2%97%E9%A2%97%E7%B2%92%E7%AD%96%E7%95%A5.html" title="缓存替换算法"><img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202505112103982.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="缓存替换算法"/></a><div class="content"><a class="title" href="/post/%E7%BC%93%E5%AD%98%E6%9B%BF%E6%8D%A2%E7%AE%97%E6%B3%951-%E7%B2%97%E9%A2%97%E7%B2%92%E7%AD%96%E7%95%A5.html" title="缓存替换算法">缓存替换算法</a><time datetime="2025-01-21T06:33:23.000Z" title="发表于 2025-01-21 14:33:23">2025-01-21</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/post/%E7%BC%93%E5%AD%98%E6%9B%BF%E6%8D%A2%E7%AE%97%E6%B3%950.html" title="Cache Replacement Policies - introduction"><img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202505112103982.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Cache Replacement Policies - introduction"/></a><div class="content"><a class="title" href="/post/%E7%BC%93%E5%AD%98%E6%9B%BF%E6%8D%A2%E7%AE%97%E6%B3%950.html" title="Cache Replacement Policies - introduction">Cache Replacement Policies - introduction</a><time datetime="2025-01-20T11:24:52.000Z" title="发表于 2025-01-20 19:24:52">2025-01-20</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/post/%E7%BC%93%E5%AD%98%E6%9B%BF%E6%8D%A2%E7%AE%97%E6%B3%952-%E7%BB%86%E9%A2%97%E7%B2%92%E7%AD%96%E7%95%A5.html" title="缓存替换算法"><img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202505112103982.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="缓存替换算法"/></a><div class="content"><a class="title" href="/post/%E7%BC%93%E5%AD%98%E6%9B%BF%E6%8D%A2%E7%AE%97%E6%B3%952-%E7%BB%86%E9%A2%97%E7%B2%92%E7%AD%96%E7%95%A5.html" title="缓存替换算法">缓存替换算法</a><time datetime="2025-01-20T11:24:52.000Z" title="发表于 2025-01-20 19:24:52">2025-01-20</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/post/2024-lastday.html" title="2024-总结"><img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202501010045372.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="2024-总结"/></a><div class="content"><a class="title" href="/post/2024-lastday.html" title="2024-总结">2024-总结</a><time datetime="2024-12-31T14:59:00.000Z" title="发表于 2024-12-31 22:59:00">2024-12-31</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/post/riscv%20v%E6%89%A9%E5%B1%95%E7%BF%BB%E8%AF%91%E6%80%BB%E7%BB%93.html" title="v扩展翻译总结”"><img src="https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202411102035591.jfif" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="v扩展翻译总结”"/></a><div class="content"><a class="title" href="/post/riscv%20v%E6%89%A9%E5%B1%95%E7%BF%BB%E8%AF%91%E6%80%BB%E7%BB%93.html" title="v扩展翻译总结”">v扩展翻译总结”</a><time datetime="2024-11-10T12:30:33.000Z" title="发表于 2024-11-10 20:30:33">2024-11-10</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('https://chilh-1311344212.cos.ap-beijing.myqcloud.com/picture/202307211649897.jpg')"><div id="footer-wrap"><div class="copyright">&copy;2021 - 2025 By chilh</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>function loadWaline () {
  function insertCSS () {
    const link = document.createElement("link")
    link.rel = "stylesheet"
    link.href = "https://cdn.jsdelivr.net/npm/@waline/client/dist/waline.min.css"
    document.head.appendChild(link)
  }

  function initWaline () {
    const waline = Waline.init(Object.assign({
      el: '#waline-wrap',
      serverURL: 'https://chilh-comment-nwkfkyqk8-zhanzghouhe.vercel.app',
      pageview: false,
      dark: 'html[data-theme="dark"]',
      path: window.location.pathname,
      comment: false,
    }, null))
  }

  if (typeof Waline === 'function') initWaline()
  else {
    insertCSS()
    getScript('https://cdn.jsdelivr.net/npm/@waline/client/dist/waline.min.js').then(initWaline)
  }
}

if ('Waline' === 'Waline' || !true) {
  if (true) btf.loadComment(document.getElementById('waline-wrap'),loadWaline)
  else setTimeout(loadWaline, 0)
} else {
  function loadOtherComment () {
    loadWaline()
  }
}</script></div><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-nest.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"model":{"jsonPath":"/live2dw/assets/wanko.model.json"},"display":{"position":"right","width":85,"height":400,"hOffset":-18,"vOffset":25},"mobile":{"show":true},"react":{"opacity":0.7},"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body></html>